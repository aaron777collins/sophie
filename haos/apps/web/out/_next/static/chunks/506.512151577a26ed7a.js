"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[506],{75506:(e,t,r)=>{r.r(t),r.d(t,{PerformanceMonitor:()=>s,initializePerformanceMonitoring:()=>a,performanceMonitor:()=>i});class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}initializeWebVitals(){if("undefined"!=typeof PerformanceObserver){try{let e=new PerformanceObserver(e=>{let t=e.getEntries(),r=t[t.length-1];r&&this.recordWebVital({name:"LCP",value:r.startTime,timestamp:Date.now(),id:"lcp_".concat(Date.now()),rating:this.rateWebVital("LCP",r.startTime)})});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}catch(e){console.warn("LCP observer not supported:",e)}try{let e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"first-contentful-paint"===e.name&&this.recordWebVital({name:"FCP",value:e.startTime,timestamp:Date.now(),id:"fcp_".concat(Date.now()),rating:this.rateWebVital("FCP",e.startTime)})})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}catch(e){console.warn("FCP observer not supported:",e)}try{let e=new PerformanceObserver(e=>{let t=0;e.getEntries().forEach(e=>{e.hadRecentInput||(t+=e.value)}),t>0&&this.recordWebVital({name:"CLS",value:t,timestamp:Date.now(),id:"cls_".concat(Date.now()),rating:this.rateWebVital("CLS",t)})});e.observe({entryTypes:["layout-shift"]}),this.observers.push(e)}catch(e){console.warn("CLS observer not supported:",e)}try{let e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.recordWebVital({name:"FID",value:e.processingStart-e.startTime,timestamp:Date.now(),id:"fid_".concat(Date.now()),rating:this.rateWebVital("FID",e.processingStart-e.startTime)})})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}catch(e){console.warn("FID observer not supported:",e)}try{let e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{let t=e.responseStart-e.requestStart;this.recordWebVital({name:"TTFB",value:t,timestamp:Date.now(),id:"ttfb_".concat(Date.now()),rating:this.rateWebVital("TTFB",t)})})});e.observe({entryTypes:["navigation"]}),this.observers.push(e)}catch(e){console.warn("TTFB observer not supported:",e)}}}rateWebVital(e,t){let r={LCP:{good:2500,poor:4e3},FCP:{good:1800,poor:3e3},CLS:{good:.1,poor:.25},FID:{good:100,poor:300},TTFB:{good:800,poor:1800}}[e];return!r||t<=r.good?"good":t<=r.poor?"needs-improvement":"poor"}startMemoryMonitoring(){"undefined"!=typeof performance&&"memory"in performance&&(this.memoryMonitorInterval=setInterval(()=>{let e=performance.memory;e&&this.recordMemoryMetric({usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit,timestamp:Date.now()})},1e4))}setMatrixClient(e){this.matrixClient=e,this.initializeMatrixAPIMonitoring()}initializeMatrixAPIMonitoring(){if(!this.matrixClient||"undefined"==typeof performance)return;let e=this.matrixClient.http.request;this.matrixClient.http.request=async(t,r,s,i,a)=>{let o=performance.now(),n="req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));try{let m=await e.call(this.matrixClient.http,t,r,s,i,a),c=performance.now()-o;return this.recordMatrixAPIMetric({endpoint:r,method:t.toUpperCase(),duration:c,timestamp:Date.now(),status:"success",requestId:n}),m}catch(s){let e="undefined"!=typeof performance?performance.now()-o:0;throw this.recordMatrixAPIMetric({endpoint:r,method:t.toUpperCase(),duration:e,timestamp:Date.now(),status:"error",errorMessage:s instanceof Error?s.message:"Unknown error",requestId:n}),s}}}recordWebVital(e){this.metrics.webVitals.push(e),this.trimMetrics("webVitals",100)}recordMatrixAPIMetric(e){this.metrics.matrixAPI.push(e),this.trimMetrics("matrixAPI",500)}recordMemoryMetric(e){this.metrics.memory.push(e),this.trimMetrics("memory",288)}trimMetrics(e,t){this.metrics[e].length>t&&("webVitals"===e?this.metrics.webVitals=this.metrics.webVitals.slice(-t):"matrixAPI"===e?this.metrics.matrixAPI=this.metrics.matrixAPI.slice(-t):"memory"===e&&(this.metrics.memory=this.metrics.memory.slice(-t)))}getMetricsSnapshot(){return{webVitals:[...this.metrics.webVitals],matrixAPI:[...this.metrics.matrixAPI],memory:[...this.metrics.memory],timestamp:Date.now(),sessionId:this.sessionId}}getPerformanceStats(){let e=Date.now(),t=e-6e4,r=e-3e5,s=this.metrics.matrixAPI.filter(e=>e.timestamp>r),i={totalRequests:s.length,successfulRequests:s.filter(e=>"success"===e.status).length,errorRequests:s.filter(e=>"error"===e.status).length,averageResponseTime:s.length>0?s.reduce((e,t)=>e+t.duration,0)/s.length:0,slowestRequest:s.reduce((e,t)=>t.duration>e.duration?t:e,{duration:0,endpoint:"",method:"",timestamp:0,status:"success",requestId:""})};this.metrics.webVitals.filter(e=>e.timestamp>t);let a={LCP:this.getLatestMetric("LCP"),FCP:this.getLatestMetric("FCP"),CLS:this.getLatestMetric("CLS"),FID:this.getLatestMetric("FID"),TTFB:this.getLatestMetric("TTFB")},o=this.metrics.memory[this.metrics.memory.length-1],n=o?{usedMB:Math.round(o.usedJSHeapSize/1024/1024),totalMB:Math.round(o.totalJSHeapSize/1024/1024),limitMB:Math.round(o.jsHeapSizeLimit/1024/1024),usagePercentage:Math.round(o.usedJSHeapSize/o.jsHeapSizeLimit*100)}:null,m=this.sessionId.split("_")[1],c=m?parseInt(m):Date.now();return{session:{id:this.sessionId,startTime:new Date(c).toISOString(),uptime:Math.round((e-c)/1e3)},api:i,webVitals:a,memory:n,timestamp:e}}getLatestMetric(e){let t=this.metrics.webVitals.filter(t=>t.name===e);return t.length>0&&t[t.length-1]||null}exportData(){let e=this.getMetricsSnapshot(),t=this.getPerformanceStats();return JSON.stringify({export:{timestamp:new Date().toISOString(),version:"1.0.0",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"Unknown"},session:t.session,metrics:e,statistics:t},null,2)}clearMetrics(){this.metrics={webVitals:[],matrixAPI:[],memory:[]}}cleanup(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.memoryMonitorInterval&&(clearInterval(this.memoryMonitorInterval),this.memoryMonitorInterval=void 0)}constructor(){this.metrics={webVitals:[],matrixAPI:[],memory:[]},this.observers=[],this.sessionId="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),this.initializeWebVitals(),this.startMemoryMonitoring()}}let i=s.getInstance(),a=e=>(e&&i.setMatrixClient(e),i)}}]);