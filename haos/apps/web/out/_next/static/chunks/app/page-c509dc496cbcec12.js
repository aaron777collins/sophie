(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{13462:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eV});var a=s(14034),r=s(86042),i=s(90890),n=s(11922),l=s(85077),c=s(24551);let o=[{id:"gaming",name:"Gaming Community",description:"Perfect for gaming groups and clans",channels:[{name:"general",type:"text"},{name:"gaming-chat",type:"text"},{name:"voice-chat",type:"voice"},{name:"announcements",type:"text"}]},{id:"study",name:"Study Group",description:"Organized spaces for learning and collaboration",channels:[{name:"general",type:"text"},{name:"homework-help",type:"text"},{name:"study-sessions",type:"voice"},{name:"resources",type:"text"}]},{id:"creative",name:"Creative Project",description:"For artists, writers, and creators",channels:[{name:"general",type:"text"},{name:"showcase",type:"text"},{name:"feedback",type:"text"},{name:"creative-voice",type:"voice"}]},{id:"custom",name:"Custom Server",description:"Start with basic channels and customize later",channels:[{name:"general",type:"text"},{name:"random",type:"text"},{name:"voice-chat",type:"voice"}]}];var d=s(64389);let h=[{id:"matrix-hq",name:"Matrix HQ",alias:"#matrix:matrix.org",description:"The official Matrix community space",members:15e3,avatar:null,category:"Official"},{id:"element-community",name:"Element Community",alias:"#element-community:matrix.org",description:"Community discussions about Element",members:8500,avatar:null,category:"Community"},{id:"matrix-dev",name:"Matrix Developers",alias:"#matrix-dev:matrix.org",description:"Technical discussions about Matrix development",members:3200,avatar:null,category:"Development"},{id:"synapse",name:"Synapse",alias:"#synapse:matrix.org",description:"Support and discussion for Synapse homeserver",members:2100,avatar:null,category:"Support"}],m=[{id:"welcome",title:"Welcome",component:function(e){let{onValidChange:t}=e;return(0,r.useEffect)(()=>{t(!0)},[t]),(0,a.jsxs)("div",{className:"max-w-2xl",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Welcome to HAOS v2"}),(0,a.jsx)("p",{className:"text-gray-400 text-lg leading-relaxed",children:"HAOS is a Discord-style Matrix client that brings the familiar Discord experience to the decentralized Matrix protocol. Get started by setting up your account and discovering Matrix servers and spaces."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-discord-darker p-6 rounded-lg border border-gray-700",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center mb-4",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD12"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Decentralized"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Your data stays with you. Choose your homeserver or run your own."})]}),(0,a.jsxs)("div",{className:"bg-discord-darker p-6 rounded-lg border border-gray-700",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-discord-green rounded-lg flex items-center justify-center mb-4",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF0D"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Open Source"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Built on open protocols and standards. No vendor lock-in."})]}),(0,a.jsxs)("div",{className:"bg-discord-darker p-6 rounded-lg border border-gray-700",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-discord-accent rounded-lg flex items-center justify-center mb-4",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCAC"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Familiar Experience"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Discord-like UI and features you already know and love."})]}),(0,a.jsxs)("div",{className:"bg-discord-darker p-6 rounded-lg border border-gray-700",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-discord-yellow rounded-lg flex items-center justify-center mb-4",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDE80"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Modern Features"}),(0,a.jsx)("p",{className:"text-gray-400",children:"End-to-end encryption, file sharing, voice chat, and more."})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-primary-500/10 border border-primary-500/20 rounded-lg",children:(0,a.jsxs)("p",{className:"text-primary-300 text-sm",children:[(0,a.jsx)("strong",{children:"Getting Started:"})," In the next steps, we'll help you create an account, set up your server, and join your first channels. This should only take a few minutes!"]})})]})}},{id:"account",title:"Create Account",component:function(e){let{onValidChange:t}=e,{setUserData:s}=(0,i.j)(),[n,l]=(0,r.useState)(""),[c,o]=(0,r.useState)(""),[d,h]=(0,r.useState)("matrix.org");return(0,r.useEffect)(()=>{let e=n.length>=3&&c.length>=1&&d.length>=3;t(e),e&&s({username:n,displayName:c})},[n,c,d,t,s]),(0,a.jsxs)("div",{className:"max-w-2xl",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Create Your Account"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Set up your Matrix account to start using HAOS. You can use an existing homeserver or choose matrix.org."})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Homeserver"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"matrix.org",className:"discord-input w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Your homeserver (e.g., matrix.org, your-server.com)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),(0,a.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"username",className:"discord-input w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Your Matrix username (minimum 3 characters)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Display Name"}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"Your display name",className:"discord-input w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"How others will see your name in conversations"})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-primary-500/10 border border-primary-500/20 rounded-lg",children:(0,a.jsxs)("p",{className:"text-primary-300 text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," This is a demo step. In the full implementation, you would either login with existing credentials or register a new account with your chosen homeserver."]})})]})}},{id:"server",title:"Create Server",component:function(e){var t,s;let{onValidChange:d}=e,{setServerData:h}=(0,i.j)(),[m,u]=(0,r.useState)(""),[x,p]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=m.length>=2&&x.length>0;if(d(e),e){let e=o.find(e=>e.id===x);h({name:m,template:x,channels:(null==e?void 0:e.channels)||[]})}},[m,x,d,h]),(0,a.jsxs)("div",{className:"max-w-4xl",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Create Your Server"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Set up your Matrix space with channels organized for your community's needs."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server Name"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"My Awesome Server",className:"discord-input w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Choose a name for your Matrix space"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Server Template"}),(0,a.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,a.jsx)("div",{onClick:()=>p(e.id),className:"\n                    p-4 rounded-lg border cursor-pointer transition-colors\n                    ".concat(x===e.id?"bg-primary-500/20 border-primary-500/30":"bg-discord-darker border-gray-600 hover:border-gray-500","\n                  "),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-discord-light rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(n.A,{className:"w-4 h-4 text-gray-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-white mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:e.description}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.channels.map((e,t)=>(0,a.jsxs)("span",{className:"text-xs bg-discord-light px-2 py-1 rounded flex items-center space-x-1",children:["text"===e.type?(0,a.jsx)(l.A,{className:"w-3 h-3"}):(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"text-gray-300",children:e.name})]},t))})]})]})},e.id))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Server Preview"}),(0,a.jsx)("div",{className:"bg-discord-darker border border-gray-700 rounded-lg p-6",children:m&&x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-white",children:m}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:null==(t=o.find(e=>e.id===x))?void 0:t.name})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-gray-300 mb-3",children:"Channels"}),(0,a.jsx)("div",{className:"space-y-2",children:null==(s=o.find(e=>e.id===x))?void 0:s.channels.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:["text"===e.type?(0,a.jsx)(l.A,{className:"w-4 h-4 text-gray-400"}):(0,a.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-gray-300",children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 capitalize",children:["(",e.type,")"]})]},t))})]})]}):(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[(0,a.jsx)(n.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-600"}),(0,a.jsx)("p",{children:"Enter a server name and select a template to see a preview"})]})})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-primary-500/10 border border-primary-500/20 rounded-lg",children:(0,a.jsxs)("p",{className:"text-primary-300 text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," This step creates a Matrix space and rooms. You can always add, remove, or reorganize channels later through the server settings."]})})]})}},{id:"join",title:"Join Channel",component:function(e){let{onValidChange:t}=e,[s,i]=(0,r.useState)([]),[o,m]=(0,r.useState)("");return(0,r.useEffect)(()=>{t(!0)},[t]),(0,a.jsxs)("div",{className:"max-w-4xl",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Join Communities"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Discover and join Matrix communities to get started. You can always find more later!"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Featured Communities"}),(0,a.jsx)("div",{className:"space-y-3",children:h.map(e=>{var t;return(0,a.jsx)("div",{onClick:()=>{var t;return t=e.id,void i(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"\n                  p-4 rounded-lg border cursor-pointer transition-colors\n                  ".concat(s.includes(e.id)?"bg-primary-500/20 border-primary-500/30":"bg-discord-darker border-gray-600 hover:border-gray-500","\n                "),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-discord-light rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(l.A,{className:"w-6 h-6 text-gray-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-white",children:e.name}),(0,a.jsx)("span",{className:"text-xs bg-discord-light text-gray-300 px-2 py-0.5 rounded",children:e.category})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:e.alias}),(0,a.jsx)("p",{className:"text-sm text-gray-300 mb-2 line-clamp-2",children:e.description}),(0,a.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:[(t=e.members)<1e3?t.toString():t<1e6?"".concat(Math.floor(t/100)/10,"k"):"".concat(Math.floor(t/1e5)/10,"M")," members"]})]})})]}),s.includes(e.id)&&(0,a.jsx)("div",{className:"w-6 h-6 bg-primary-500 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},e.id)})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Join Custom Server"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),placeholder:"#community:example.org",className:"discord-input w-full"}),(0,a.jsx)("button",{disabled:!o.trim(),className:"discord-button-secondary w-full",children:"Join Custom Server"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Enter a Matrix room alias or ID to join any public space"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Server Discovery"}),(0,a.jsxs)("div",{className:"bg-discord-darker border border-gray-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)(n.A,{className:"w-8 h-8 text-primary-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Browse More Communities"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Discover thousands of public Matrix spaces"})]})]}),(0,a.jsxs)("button",{className:"discord-button w-full flex items-center justify-center space-x-2",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Open Server Discovery"})]})]})]}),s.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"Selected Communities"}),(0,a.jsxs)("div",{className:"bg-discord-darker border border-gray-700 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>{let t=h.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)(l.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-white",children:t.name})]},e):null})}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:"These communities will be added to your sidebar when you complete setup"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-primary-500/10 border border-primary-500/20 rounded-lg",children:(0,a.jsxs)("p",{className:"text-primary-300 text-sm",children:[(0,a.jsx)("strong",{children:"Pro tip:"})," You can always discover more communities later using the server discovery feature. Start with a few that interest you and explore more as you get familiar with Matrix!"]})})]})}}];function u(e){let{onComplete:t}=e,{state:s,nextStep:n,prevStep:l,resetFlow:c}=(0,i.j)(),[o,d]=(0,r.useState)(!1),h=m[s.currentStep],u=null==h?void 0:h.component;return h&&u?(0,a.jsxs)("div",{className:"min-h-screen bg-discord-dark flex",children:[(0,a.jsxs)("div",{className:"w-80 bg-discord-darker border-r border-gray-700 p-6 flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Welcome to HAOS"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Get started in just a few steps"})]}),(0,a.jsx)("div",{className:"space-y-4 flex-1",children:m.map((e,t)=>{let r=t<s.currentStep,i=t===s.currentStep;return s.currentStep,(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"\n                  w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold\n                  ".concat(r||i?"bg-primary-500 text-white":"bg-gray-600 text-gray-400","\n                "),children:r?"✓":t+1}),(0,a.jsx)("span",{className:"\n                  font-medium\n                  ".concat(i?"text-white":r?"text-gray-300":"text-gray-500","\n                "),children:e.title})]},e.id)})}),(0,a.jsx)("div",{className:"pt-6 border-t border-gray-700",children:(0,a.jsx)("button",{onClick:()=>{localStorage.setItem("haos-first-run-skipped","true"),t()},className:"text-gray-400 hover:text-gray-300 text-sm transition-colors",children:"Skip setup - I'll configure later"})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-discord-dark border-b border-gray-700 p-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:null==h?void 0:h.title}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:["Step ",s.currentStep+1," of ",s.totalSteps]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[s.currentStep>0&&(0,a.jsx)("button",{onClick:l,className:"discord-button-secondary",children:"Back"}),(0,a.jsx)("button",{onClick:()=>{s.currentStep===s.totalSteps-1?t():(n(),d(!1))},disabled:!o,className:"discord-button",children:s.currentStep===s.totalSteps-1?"Get Started!":"Continue"})]})]}),(0,a.jsx)("div",{className:"flex-1 p-8 overflow-auto",children:(0,a.jsx)(u,{onValidChange:d})})]})]}):(0,a.jsx)("div",{children:"Invalid step"})}var x=s(9063),p=s(81489),g=s(99575),f=s(34631),b=s(15156),v=s(54396),y=s(72170),j=s(18202),w=s(68687),N=s(91399),S=s(73887),k=s(35262),C=s(40221),E=s(79761);function A(e){let{open:t,onOpenChange:s}=e,[i,l]=(0,r.useState)(""),[c,o]=(0,r.useState)("all"),[d,h]=(0,r.useState)(null),[m,u]=(0,r.useState)([]),[x,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),{client:b,getPublicRooms:v}=(0,E.W)();(0,r.useEffect)(()=>{t&&b&&y()},[t,b]);let y=async()=>{if(b){p(!0),f(null);try{let e=await v({limit:50,filter:{generic_search_term:i||void 0}});u(e.chunk||[])}catch(e){console.error("Failed to load public rooms:",e),f("Failed to load servers. Please try again.")}finally{p(!1)}}},A=m.filter(e=>{var t,s,a,r,n;let l=!i||(null==(t=e.name)?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null==(s=e.topic)?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null==(a=e.canonical_alias)?void 0:a.toLowerCase().includes(i.toLowerCase())),o="all"===c||null!=(n=null==(r=e.topic)?void 0:r.toLowerCase().includes(c.toLowerCase()))&&n;return l&&o});return(0,a.jsx)(j.bL,{open:t,onOpenChange:s,children:(0,a.jsxs)(j.ZL,{children:[(0,a.jsx)(j.hJ,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),(0,a.jsx)(j.UC,{className:"fixed left-1/2 top-1/2 z-50 w-[90vw] max-w-6xl max-h-[90vh] -translate-x-1/2 -translate-y-1/2",children:(0,a.jsxs)("div",{className:"bg-discord-dark border border-gray-700 rounded-lg shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-discord-darker border-b border-gray-700 p-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j.hE,{className:"text-xl font-semibold text-white",children:"Discover Matrix Servers"}),(0,a.jsx)(j.VY,{className:"text-gray-400 text-sm",children:"Browse and join public Matrix spaces and rooms"})]})]}),(0,a.jsx)(j.bm,{className:"text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)(w.A,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"flex h-[calc(90vh-120px)]",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col border-r border-gray-700",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-700 space-y-4",children:[(0,a.jsx)(S.e,{query:i,onQueryChange:l,onSearch:y,loading:x}),(0,a.jsx)(k.b,{selectedCategory:c,onCategoryChange:o,rooms:m})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:g?(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"text-discord-red mb-2",children:g}),(0,a.jsx)("button",{onClick:y,className:"discord-button-secondary",children:"Try Again"})]}):(0,a.jsx)(N.e,{rooms:A,loading:x,selectedServer:d,onServerSelect:h})})]}),(0,a.jsx)("div",{className:"w-96",children:(0,a.jsx)(C.U,{server:d,onJoin:e=>{console.log("Joining server:",e),s(!1)}})})]})]})})]})})}var T=s(45374),F=s(21373),M=s(82548),U=s(62103);class P{async requestToken(e,t,s){try{let a=await fetch("".concat(this.config.jwtServiceUrl,"/sfu/get"),{method:"POST",headers:{"Content-Type":"application/json",...(null==s?void 0:s.matrixAccessToken)&&{Authorization:"Bearer ".concat(s.matrixAccessToken)}},body:JSON.stringify({room:e,identity:t,name:(null==s?void 0:s.name)||t})});if(!a.ok){let e=await a.text();throw Error("Failed to get LiveKit token: ".concat(a.status," ").concat(e))}let r=await a.json();if(!r.jwt)throw Error("No JWT token in response");return r.jwt}catch(t){let e=Error("Failed to request LiveKit token: ".concat(t instanceof Error?t.message:"Unknown error"));throw this.handleError(e),e}}async connectToRoom(e,t,s){var a;if(this.isConnecting)throw Error("Connection already in progress");if((null==(a=this.room)?void 0:a.state)==="connected")throw Error("Already connected to a room. Disconnect first.");this.isConnecting=!0,this.reconnectAttempts=0;try{return this.room=new U.Wv({...s}),this.setupRoomEventListeners(),await this.room.connect(this.config.url,t,{autoSubscribe:!0}),this.isConnecting=!1,this.room}catch(s){this.isConnecting=!1;let t=Error("Failed to connect to room ".concat(e,": ").concat(s instanceof Error?s.message:"Unknown error"));throw this.handleError(t),t}}async disconnect(){if(this.room)try{await this.room.disconnect(),this.room=null,this.reconnectAttempts=0}catch(t){let e=Error("Failed to disconnect: ".concat(t instanceof Error?t.message:"Unknown error"));throw this.handleError(e),e}}getRoom(){return this.room}isConnected(){var e;return(null==(e=this.room)?void 0:e.state)==="connected"}getParticipants(){if(!this.room)return[];let e=[];return this.room.localParticipant&&e.push(this.mapParticipant(this.room.localParticipant,!0)),this.room.remoteParticipants.forEach(t=>{e.push(this.mapParticipant(t,!1))}),e}async setAudioEnabled(e){var t;if(!(null==(t=this.room)?void 0:t.localParticipant))throw Error("Not connected to a room");try{await this.room.localParticipant.setMicrophoneEnabled(e)}catch(s){let t=Error("Failed to ".concat(e?"enable":"disable"," audio: ").concat(s instanceof Error?s.message:"Unknown error"));throw this.handleError(t),t}}async setVideoEnabled(e){var t;if(!(null==(t=this.room)?void 0:t.localParticipant))throw Error("Not connected to a room");try{await this.room.localParticipant.setCameraEnabled(e)}catch(s){let t=Error("Failed to ".concat(e?"enable":"disable"," video: ").concat(s instanceof Error?s.message:"Unknown error"));throw this.handleError(t),t}}async startScreenShare(){var e;if(!(null==(e=this.room)?void 0:e.localParticipant))throw Error("Not connected to a room");try{await this.room.localParticipant.setScreenShareEnabled(!0,{audio:!0})}catch(t){let e=Error("Failed to start screen share: ".concat(t instanceof Error?t.message:"Unknown error"));throw this.handleError(e),e}}async stopScreenShare(){var e;if(!(null==(e=this.room)?void 0:e.localParticipant))throw Error("Not connected to a room");try{await this.room.localParticipant.setScreenShareEnabled(!1)}catch(t){let e=Error("Failed to stop screen share: ".concat(t instanceof Error?t.message:"Unknown error"));throw this.handleError(e),e}}async sendData(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reliable";if(!(null==(t=this.room)?void 0:t.localParticipant))throw Error("Not connected to a room");try{let t=new TextEncoder,a="string"==typeof e?t.encode(e):e;await this.room.localParticipant.publishData(a,{reliable:"reliable"===s})}catch(t){let e=Error("Failed to send data: ".concat(t instanceof Error?t.message:"Unknown error"));throw this.handleError(e),e}}setEventHandlers(e){this.onParticipantConnected=e.onParticipantConnected,this.onParticipantDisconnected=e.onParticipantDisconnected,this.onTrackSubscribed=e.onTrackSubscribed,this.onTrackUnsubscribed=e.onTrackUnsubscribed,this.onConnectionStateChanged=e.onConnectionStateChanged,this.onError=e.onError,this.onSpeakingChanged=e.onSpeakingChanged}setupRoomEventListeners(){this.room&&(this.room.on("participantConnected",e=>{var t;null==(t=this.onParticipantConnected)||t.call(this,e)}),this.room.on("participantDisconnected",e=>{var t;null==(t=this.onParticipantDisconnected)||t.call(this,e)}),this.room.on("trackSubscribed",(e,t,s)=>{var a;null==(a=this.onTrackSubscribed)||a.call(this,e,s)}),this.room.on("trackUnsubscribed",(e,t,s)=>{var a;null==(a=this.onTrackUnsubscribed)||a.call(this,e,s)}),this.room.on("activeSpeakersChanged",e=>{let t=new Set(e.map(e=>e.identity));this.getParticipants().forEach(e=>{var s;null==(s=this.onSpeakingChanged)||s.call(this,e.identity,t.has(e.identity))})}),this.room.on("reconnecting",()=>{var e;null==(e=this.onConnectionStateChanged)||e.call(this,"reconnecting")}),this.room.on("reconnected",()=>{var e;this.reconnectAttempts=0,null==(e=this.onConnectionStateChanged)||e.call(this,"connected")}),this.room.on("disconnected",e=>{var t;null==(t=this.onConnectionStateChanged)||t.call(this,"disconnected")}),this.room.on("dataReceived",(e,t,s)=>{}),this.room.on("connectionQualityChanged",(e,t)=>{}),this.room.on("mediaDevicesError",e=>{this.handleError(Error("Media devices error: ".concat(e.message)))}))}mapParticipant(e,t){return{identity:e.identity,name:e.name||e.identity,metadata:e.metadata,isLocal:t,audioEnabled:e.isMicrophoneEnabled,videoEnabled:e.isCameraEnabled,screenShareEnabled:e.isScreenShareEnabled,isSpeaking:!1}}handleError(e){var t;null==(t=this.onError)||t.call(this,e)}constructor(e){this.room=null,this.isConnecting=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.config={url:(null==e?void 0:e.url)||"wss://livekit.dev2.aaroncollins.info",jwtServiceUrl:(null==e?void 0:e.jwtServiceUrl)||"https://dev2.aaroncollins.info/_livekit"}}}let q=null;function D(){return q||(q=new P),q}var R=s(83185),L=s(10626);let I={connectionState:"disconnected",currentChannel:null,error:null,isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharing:!1,isDeafened:!1,isSpeaking:!1,participants:new Map,settings:{inputDevice:null,outputDevice:null,inputVolume:100,outputVolume:100,noiseSuppression:!0,echoCancellation:!0,autoGainControl:!0,pushToTalk:!1,pushToTalkKey:"`"}},V=(0,R.vt)()((0,L.Zr)((e,t)=>({...I,setConnectionState:t=>e({connectionState:t}),setCurrentChannel:t=>e({currentChannel:t}),setError:t=>e({error:t}),setAudioEnabled:t=>e({isAudioEnabled:t}),setVideoEnabled:t=>e({isVideoEnabled:t}),setScreenSharing:t=>e({isScreenSharing:t}),setDeafened:t=>e({isDeafened:t}),setSpeaking:t=>e({isSpeaking:t}),addParticipant:s=>{let{participants:a}=t(),r=new Map(a);r.set(s.identity,s),e({participants:r})},removeParticipant:s=>{let{participants:a}=t(),r=new Map(a);r.delete(s),e({participants:r})},updateParticipant:(s,a)=>{let{participants:r}=t(),i=r.get(s);if(i){let t=new Map(r);t.set(s,{...i,...a}),e({participants:t})}},clearParticipants:()=>e({participants:new Map}),updateSettings:s=>{let{settings:a}=t();e({settings:{...a,...s}})},resetState:()=>e({connectionState:"disconnected",currentChannel:null,error:null,isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharing:!1,isDeafened:!1,isSpeaking:!1,participants:new Map})}),{name:"haos-voice-settings",partialize:e=>({settings:e.settings,isAudioEnabled:e.isAudioEnabled,isVideoEnabled:e.isVideoEnabled})}));function z(e){let{roomName:t,userId:s,userName:a=s,matrixAccessToken:i,autoConnect:n=!1}=e,l=(0,r.useRef)(null),[c,o]=(0,r.useState)(null),[d,h]=(0,r.useState)(!1),{connectionState:m,setConnectionState:u,setCurrentChannel:x,setError:p,isAudioEnabled:g,setAudioEnabled:f,isVideoEnabled:b,setVideoEnabled:v,isScreenSharing:y,setScreenSharing:j,isDeafened:w,setDeafened:N,participants:S,addParticipant:k,removeParticipant:C,updateParticipant:E,clearParticipants:A,error:T}=V();(0,r.useEffect)(()=>(l.current=D(),l.current.setEventHandlers({onParticipantConnected:e=>{var t;k({identity:(t=e).identity,name:t.name||t.identity,isSpeaking:!1,isAudioEnabled:t.isMicrophoneEnabled,isVideoEnabled:t.isCameraEnabled,isScreenSharing:t.isScreenShareEnabled,isLocal:!1,connectionQuality:"unknown"})},onParticipantDisconnected:e=>{C(e.identity)},onTrackSubscribed:(e,t)=>{E(t.identity,{isAudioEnabled:t.isMicrophoneEnabled,isVideoEnabled:t.isCameraEnabled,isScreenSharing:t.isScreenShareEnabled})},onTrackUnsubscribed:(e,t)=>{E(t.identity,{isAudioEnabled:t.isMicrophoneEnabled,isVideoEnabled:t.isCameraEnabled,isScreenSharing:t.isScreenShareEnabled})},onConnectionStateChanged:e=>{u(e)},onError:e=>{p(e.message)},onSpeakingChanged:(e,t)=>{E(e,{isSpeaking:t})}}),()=>{var e;(null==(e=l.current)?void 0:e.isConnected())&&l.current.disconnect()}),[]),(0,r.useEffect)(()=>{!n||c||d||F()},[n]);let F=(0,r.useCallback)(async()=>{if(l.current&&!d){h(!0),u("connecting"),p(null);try{let e=await l.current.requestToken(t,s,{name:a,matrixAccessToken:i}),r=await l.current.connectToRoom(t,e);o(r),u("connected"),x({id:t,name:t,participants:[]}),l.current.getParticipants().forEach(e=>{var t;k({identity:(t=e).identity,name:t.name||t.identity,avatar:t.avatar,isSpeaking:t.isSpeaking,isAudioEnabled:t.audioEnabled,isVideoEnabled:t.videoEnabled,isScreenSharing:t.screenShareEnabled,isLocal:t.isLocal,connectionQuality:"unknown"})})}catch(e){p(e instanceof Error?e.message:"Failed to connect"),u("error")}finally{h(!1)}}},[t,s,a,i]),M=(0,r.useCallback)(async()=>{if(l.current)try{await l.current.disconnect(),o(null),u("disconnected"),x(null),A()}catch(e){p(e instanceof Error?e.message:"Failed to disconnect")}},[]),U=(0,r.useCallback)(async()=>{var e;if(null==(e=l.current)?void 0:e.isConnected())try{let e=!g;await l.current.setAudioEnabled(e),f(e)}catch(e){p(e instanceof Error?e.message:"Failed to toggle audio")}},[g]),P=(0,r.useCallback)(async()=>{var e;if(null==(e=l.current)?void 0:e.isConnected())try{let e=!b;await l.current.setVideoEnabled(e),v(e)}catch(e){p(e instanceof Error?e.message:"Failed to toggle video")}},[b]),q=(0,r.useCallback)(async()=>{var e;if(null==(e=l.current)?void 0:e.isConnected())try{y?await l.current.stopScreenShare():await l.current.startScreenShare(),j(!y)}catch(e){p(e instanceof Error?e.message:"Failed to toggle screen share")}},[y]),R=(0,r.useCallback)(()=>{let e=!w;N(e),e&&g&&U()},[w,g,U]);return{room:c,isConnected:"connected"===m,isConnecting:d,connectionState:m,participants:Array.from(S.values()),error:T,isAudioEnabled:g,isVideoEnabled:b,isScreenSharing:y,isDeafened:w,connect:F,disconnect:M,toggleAudio:U,toggleVideo:P,toggleScreenShare:q,toggleDeafen:R}}function O(e){let{channels:t,currentUserId:s,onJoinChannel:i,onCreateChannel:n,className:l=""}=e,[o,d]=(0,r.useState)(null),{currentChannel:h,connectionState:m}=V(),{connect:u,disconnect:x,isConnecting:g}=z({roomName:"",userId:s}),f=async e=>{if(!o&&"connecting"!==m){d(e);try{h&&h.id!==e&&await x(),null==i||i(e)}catch(e){console.error("Failed to join channel:",e)}finally{d(null)}}};return(0,a.jsxs)("div",{className:"space-y-2 ".concat(l),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-300 uppercase tracking-wide",children:"Voice Channels"})]}),n&&(0,a.jsx)("button",{onClick:n,className:"w-6 h-6 flex items-center justify-center hover:bg-[#40444b] text-gray-400 hover:text-white rounded transition-colors",title:"Create Channel",children:(0,a.jsx)(p.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-1",children:t.map(e=>{let t,s=o===e.id,r=(t=e.id,(null==h?void 0:h.id)===t&&"connected"===m),i=!r&&!s&&"connecting"!==m;return(0,a.jsxs)("div",{className:"group",children:[(0,a.jsx)("button",{onClick:()=>i?f(e.id):void 0,disabled:!i,className:"w-full p-2 text-left hover:bg-[#40444b] transition-colors rounded ".concat(r?"bg-[#40444b] text-white":"text-gray-300 hover:text-white"," ").concat(i?"cursor-pointer":"cursor-default"),title:i?"Join ".concat(e.name):void 0,children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[e.isPrivate?(0,a.jsx)(T.A,{className:"w-4 h-4 text-gray-400"}):(0,a.jsx)(b.A,{className:"w-4 h-4 ".concat(r?"text-green-400":"text-gray-400")}),(0,a.jsx)("span",{className:"font-medium truncate",children:e.name}),r&&(0,a.jsx)("span",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded",children:"Connected"})]})}),e.participantCount>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:[e.participantCount,e.maxParticipants&&"/".concat(e.maxParticipants)]})]}),!r&&(0,a.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(F.A,{className:"w-4 h-4 text-gray-400"})}),s&&(0,a.jsx)("div",{className:"w-4 h-4",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border border-gray-400 border-t-transparent"})})]})}),(r||e.participants.length>0)&&(0,a.jsx)("div",{className:"ml-6 mt-1 space-y-1",children:e.participants.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-400 hover:text-gray-300 transition-colors p-1 rounded hover:bg-[#36393f]",title:"".concat(e.name).concat(e.isLocal?" (You)":""),children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full border border-gray-600 bg-[#5865f2] text-white flex items-center justify-center text-xs font-semibold overflow-hidden",children:e.avatar?(0,a.jsx)("img",{src:e.avatar,alt:e.name,className:"w-full h-full object-cover"}):(0,a.jsx)("span",{children:e.name.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2)})}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[(0,a.jsxs)("span",{className:"truncate ".concat(e.isLocal?"text-blue-400":""," ").concat(e.isSpeaking?"text-green-400 font-medium":""),children:[e.name,e.isLocal&&" (You)"]}),e.isSpeaking&&(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",title:"Speaking"}),!e.isAudioEnabled&&(0,a.jsx)("div",{className:"w-2 h-2 bg-red-400 rounded-full",title:"Muted"}),0===t&&(0,a.jsx)("span",{title:"Owner",children:(0,a.jsx)(M.A,{className:"w-3 h-3 text-yellow-400"})})]})]},e.identity))})]},e.id)})}),0===t.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(b.A,{className:"w-8 h-8 mx-auto mb-2 text-gray-600"}),(0,a.jsx)("p",{className:"text-sm",children:"No voice channels available"}),n&&(0,a.jsx)("button",{onClick:n,className:"text-blue-400 hover:text-blue-300 text-sm mt-2 underline",children:"Create the first channel"})]})]})}var K=s(22247),H=s(55148),J=s(4138),G=s(82156),Y=s(71964),B=s(57828),_=s(81717),W=s(26912),Q=s(65116),Z=s(45922),$=s(24238),X=s.n($);function ee(e){let{isSpeaking:t,size:s="md",className:r="",audioLevel:i=.5}=e,n={sm:{container:"w-8 h-8",ring:"-inset-0.5"},md:{container:"w-12 h-12",ring:"-inset-1"},lg:{container:"w-16 h-16",ring:"-inset-1.5"}}[s];if(!t)return null;let l=Math.min(1,.3+.7*i);return(0,a.jsxs)("div",{role:"status","aria-label":"Speaking",className:"jsx-776c1f245d0ecbdc "+((0,Z.cn)("absolute inset-0 rounded-full pointer-events-none",n.container,r)||""),children:[(0,a.jsx)("div",{style:{animation:"speakingPulse 1.5s ease-in-out infinite",boxShadow:"0 0 ".concat(8*l,"px rgba(34, 197, 94, ").concat(.6*l,")")},className:"jsx-776c1f245d0ecbdc "+((0,Z.cn)("absolute rounded-full border-2 border-green-500",n.ring)||"")}),(0,a.jsx)("div",{style:{animation:"speakingExpand 2s ease-out infinite",opacity:.4},className:"jsx-776c1f245d0ecbdc "+((0,Z.cn)("absolute rounded-full border border-green-400",n.ring)||"")}),(0,a.jsx)("div",{style:{boxShadow:"inset 0 0 ".concat(4*l,"px rgba(34, 197, 94, ").concat(.3*l,")")},className:"jsx-776c1f245d0ecbdc absolute inset-0 rounded-full"}),(0,a.jsx)(X(),{id:"776c1f245d0ecbdc",children:"@keyframes speakingPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:.8}}@keyframes speakingExpand{0%{transform:scale(1);opacity:.4}100%{transform:scale(1.3);opacity:0}}"})]})}function et(e){let{participant:t,size:s="md",showVideo:r=!1,className:i="",role:n=null,onClick:l}=e,{client:c}=(0,E.W)(),o={sm:{avatar:"w-8 h-8",text:"text-xs",icon:"w-3 h-3",video:"w-24 h-18"},md:{avatar:"w-10 h-10",text:"text-sm",icon:"w-3.5 h-3.5",video:"w-32 h-24"},lg:{avatar:"w-14 h-14",text:"text-base",icon:"w-4 h-4",video:"w-40 h-30"}}[s],d=function(e,t,s,a,r){let i=t?t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("mxc://")?function(e,t,s,a,r){if(!e||!t||!t.startsWith("mxc://"))return null;try{return e.mxcUrlToHttp(t,s,a,void 0)}catch(e){return console.error("Failed to convert mxc URL to HTTP:",e),null}}(e,t,r,r)||a||null:a||null:a||null;return{httpUrl:i,initials:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e&&""!==e.trim()?e.trim().split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,t):"?"}(s),hasAvatar:!!i}}(c,t.avatar,t.name,void 0,"sm"===s?32:"md"===s?40:56),h=()=>{let e=[];return t.isLocal&&e.push("You"),t.isSpeaking&&e.push("Speaking"),t.isAudioEnabled||e.push("Muted"),t.isVideoEnabled&&e.push("Camera on"),t.isScreenSharing&&e.push("Sharing screen"),e.push((()=>{switch(t.connectionQuality){case"excellent":return"Excellent connection";case"good":return"Good connection";case"poor":return"Poor connection";default:return"Unknown connection quality"}})()),e.join(", ")},m=l?"button":"div";return r&&t.isVideoEnabled?(0,a.jsxs)(m,{onClick:l,className:(0,Z.cn)("relative flex flex-col items-center gap-2 p-3 rounded-lg bg-[#2f3136]","border border-[#40444b] transition-all",l&&"hover:bg-[#36393f] cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500",t.isSpeaking&&"ring-2 ring-green-500",i),"aria-label":"".concat(t.name,", ").concat(h()),children:[(0,a.jsxs)("div",{className:(0,Z.cn)("relative bg-[#1e1f22] rounded overflow-hidden",o.video),children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(Y.A,{className:"w-8 h-8 text-gray-600","aria-hidden":"true"})}),t.isSpeaking&&(0,a.jsx)("div",{className:"absolute inset-0 border-2 border-green-500 rounded animate-pulse pointer-events-none","aria-hidden":"true"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:(0,Z.cn)("font-medium text-white truncate",o.text),children:[t.name,t.isLocal&&" (You)"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[!t.isAudioEnabled&&(0,a.jsx)("div",{className:"bg-red-500 rounded-full p-1","aria-label":"Muted",children:(0,a.jsx)(B.A,{className:o.icon})}),t.isScreenSharing&&(0,a.jsx)("div",{className:"bg-blue-500 rounded-full p-1","aria-label":"Sharing screen",children:(0,a.jsx)(_.A,{className:o.icon})})]})]})})]}),n&&(0,a.jsx)("div",{className:(0,Z.cn)("absolute top-2 right-2 rounded-full p-1","owner"===n?"bg-yellow-500":"bg-blue-500"),children:"owner"===n?(0,a.jsx)(M.A,{className:"w-3 h-3 text-white","aria-label":"Server owner"}):(0,a.jsx)(W.A,{className:"w-3 h-3 text-white","aria-label":"Moderator"})})]}):(0,a.jsxs)(m,{onClick:l,className:(0,Z.cn)("relative flex items-center gap-3 py-1.5 px-2 rounded","text-gray-300 transition-colors",l&&"hover:bg-[#3c3f45] cursor-pointer focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",!l&&"hover:bg-[#36393f]",i),"aria-label":"".concat(t.name,", ").concat(h()),children:[(0,a.jsxs)("div",{className:(0,Z.cn)("relative flex-shrink-0",o.avatar),children:[(0,a.jsx)("div",{className:(0,Z.cn)(o.avatar,"rounded-full ring-2 bg-[#5865f2] text-white","flex items-center justify-center font-semibold overflow-hidden",(()=>{switch(t.connectionQuality){case"excellent":return"ring-green-500";case"good":return"ring-yellow-500";case"poor":return"ring-red-500";default:return"ring-gray-600"}})()),children:d.hasAvatar?(0,a.jsx)("img",{src:d.httpUrl,alt:"",className:"w-full h-full object-cover","aria-hidden":"true"}):(0,a.jsx)("span",{className:o.text,"aria-hidden":"true",children:d.initials})}),(0,a.jsx)(ee,{isSpeaking:t.isSpeaking,size:s}),n&&(0,a.jsx)("div",{className:(0,Z.cn)("absolute -top-0.5 -right-0.5 rounded-full p-0.5","owner"===n?"bg-yellow-500":"bg-blue-500"),children:"owner"===n?(0,a.jsx)(M.A,{className:"w-2.5 h-2.5 text-white"}):(0,a.jsx)(W.A,{className:"w-2.5 h-2.5 text-white"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-1.5",children:(0,a.jsxs)("span",{className:(0,Z.cn)("font-medium truncate",o.text,t.isLocal&&"text-blue-400",t.isSpeaking&&!t.isLocal&&"text-green-400"),children:[t.name,t.isLocal&&(0,a.jsx)("span",{className:"text-gray-500 font-normal",children:" (You)"})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5","aria-hidden":"true",children:[!t.isAudioEnabled&&(0,a.jsx)("div",{className:"flex items-center text-red-400",title:"Muted",children:(0,a.jsx)(B.A,{className:o.icon})}),t.isVideoEnabled?(0,a.jsx)("div",{className:"flex items-center text-green-400",title:"Camera on",children:(0,a.jsx)(Y.A,{className:o.icon})}):"sm"!==s&&(0,a.jsx)("div",{className:"flex items-center text-gray-500",title:"Camera off",children:(0,a.jsx)(Q.A,{className:o.icon})}),t.isScreenSharing&&(0,a.jsx)("div",{className:"flex items-center text-blue-400",title:"Sharing screen",children:(0,a.jsx)(_.A,{className:o.icon})})]})]})]})}function es(e){let{className:t="",showVideoGrid:s=!1}=e,{currentChannel:r,connectionState:i,participants:n,error:l}=V(),o=Array.from(n.values());return r?(0,a.jsxs)("div",{className:"bg-[#36393f] border border-[#40444b] text-gray-300 rounded-lg ".concat(t),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-[#40444b]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"w-5 h-5 text-green-400"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:r.name})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"connected":return(0,a.jsx)(K.A,{className:"w-4 h-4 text-green-400"});case"connecting":case"reconnecting":return(0,a.jsx)(H.A,{className:"w-4 h-4 text-yellow-400 animate-pulse"});case"error":return(0,a.jsx)(J.A,{className:"w-4 h-4 text-red-400"});default:return(0,a.jsx)(G.A,{className:"w-4 h-4 text-gray-400"})}})(i),(0,a.jsx)("span",{className:"text-sm font-medium ".concat((e=>{switch(e){case"connected":return"text-green-400";case"connecting":case"reconnecting":return"text-yellow-400";case"error":return"text-red-400";default:return"text-gray-400"}})(i)),children:(e=>{switch(e){case"connected":return"Connected";case"connecting":return"Connecting...";case"reconnecting":return"Reconnecting...";case"error":return"Connection Error";default:return"Disconnected"}})(i)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-400 mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[o.length," participant",1!==o.length?"s":""]})]}),r.maxParticipants&&(0,a.jsxs)("span",{children:["• Max ",r.maxParticipants]}),r.serverId&&(0,a.jsx)("span",{className:"border border-gray-600 text-gray-400 px-2 py-1 rounded text-xs",children:r.serverId})]})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[l&&(0,a.jsx)("div",{className:"p-3 bg-red-900/20 border border-red-500/30 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-red-300",children:l})]})}),o.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-300",children:"Participants"}),(0,a.jsx)("div",{className:"flex-1 h-px bg-[#40444b]"})]}),s?(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:o.map(e=>(0,a.jsx)(et,{participant:e,size:"lg",showVideo:!0},e.identity))}):(0,a.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,a.jsx)(et,{participant:e,size:"md",className:"p-2 rounded hover:bg-[#2f3136] transition-colors"},e.identity))})]}):"connected"===i?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(c.A,{className:"w-12 h-12 text-gray-500 mx-auto mb-4"}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-400 mb-2",children:"You're alone here"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Invite others to join the voice channel"})]}):null]})]}):(0,a.jsx)("div",{className:"bg-[#36393f] border border-[#40444b] text-gray-300 rounded-lg ".concat(t),children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 px-4",children:[(0,a.jsx)(b.A,{className:"w-12 h-12 text-gray-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No Voice Channel"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Join a voice channel to see participants and controls"})]})})}var ea=s(71652),er=s(3962),ei=s(14802),en=s(87039),el=s(64889),ec=s(36705);class eo{async initializeVideoCall(e){try{let t=await this.liveKit.requestToken(e.roomName,e.identity,{name:e.name,matrixAccessToken:e.matrixAccessToken});await this.liveKit.connectToRoom(e.roomName,t);let s=this.liveKit.getRoom();if(!s)throw Error("Failed to connect to room");this.state.isVideoCall=!0,this.setupVideoEventListeners(s),e.enableVideo&&await this.enableCamera(e.videoDeviceId),e.enableAudio&&await this.enableMicrophone(e.audioDeviceId),this.updateGridLayout()}catch(e){throw Error("Failed to initialize video call: ".concat(e instanceof Error?e.message:"Unknown error"))}}async enableCamera(e){try{let s=this.liveKit.getRoom();if(!(null==s?void 0:s.localParticipant))throw Error("Not connected to a room");await s.localParticipant.setCameraEnabled(!0,{deviceId:e,resolution:{width:1280,height:720},frameRate:30});let a=s.localParticipant.getTrackPublication(U.CC.Source.Camera);if((null==a?void 0:a.track)instanceof U.M0){var t;this.state.localVideoTrack=a.track;let e={trackSid:a.trackSid,participant:{identity:s.localParticipant.identity,name:s.localParticipant.name||s.localParticipant.identity},track:a.track,isLocal:!0,isScreenShare:!1},r=this.state.participants.get(s.localParticipant.identity)||[];return r.push(e),this.state.participants.set(s.localParticipant.identity,r),null==(t=this.onVideoTrackSubscribed)||t.call(this,e),this.updateGridLayout(),a.track}throw Error("Failed to get local video track")}catch(e){throw Error("Failed to enable camera: ".concat(e instanceof Error?e.message:"Unknown error"))}}async disableCamera(){try{let t=this.liveKit.getRoom();if(!(null==t?void 0:t.localParticipant))throw Error("Not connected to a room");if(await t.localParticipant.setCameraEnabled(!1),this.state.localVideoTrack){let s=(this.state.participants.get(t.localParticipant.identity)||[]).filter(e=>e.track!==this.state.localVideoTrack);if(0===s.length?this.state.participants.delete(t.localParticipant.identity):this.state.participants.set(t.localParticipant.identity,s),this.state.localVideoTrack.sid){var e;null==(e=this.onVideoTrackUnsubscribed)||e.call(this,this.state.localVideoTrack.sid)}this.state.localVideoTrack=null,this.updateGridLayout()}}catch(e){throw Error("Failed to disable camera: ".concat(e instanceof Error?e.message:"Unknown error"))}}async enableMicrophone(e){try{let t=this.liveKit.getRoom();if(!(null==t?void 0:t.localParticipant))throw Error("Not connected to a room");await t.localParticipant.setMicrophoneEnabled(!0,{deviceId:e,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});let s=t.localParticipant.getTrackPublication(U.CC.Source.Microphone);if((null==s?void 0:s.track)instanceof U.J)return this.state.localAudioTrack=s.track,s.track;throw Error("Failed to get local audio track")}catch(e){throw Error("Failed to enable microphone: ".concat(e instanceof Error?e.message:"Unknown error"))}}async disableMicrophone(){try{let e=this.liveKit.getRoom();if(!(null==e?void 0:e.localParticipant))throw Error("Not connected to a room");await e.localParticipant.setMicrophoneEnabled(!1),this.state.localAudioTrack=null}catch(e){throw Error("Failed to disable microphone: ".concat(e instanceof Error?e.message:"Unknown error"))}}async startScreenShare(){try{let t=this.liveKit.getRoom();if(!(null==t?void 0:t.localParticipant))throw Error("Not connected to a room");await t.localParticipant.setScreenShareEnabled(!0,{audio:!0});let s=t.localParticipant.getTrackPublication(U.CC.Source.ScreenShare);if((null==s?void 0:s.track)instanceof U.M0){var e;this.state.screenShareTrack=s.track;let a={trackSid:s.trackSid,participant:{identity:t.localParticipant.identity,name:t.localParticipant.name||t.localParticipant.identity},track:s.track,isLocal:!0,isScreenShare:!0},r=this.state.participants.get(t.localParticipant.identity)||[];return r.push(a),this.state.participants.set(t.localParticipant.identity,r),null==(e=this.onVideoTrackSubscribed)||e.call(this,a),this.setLayoutMode("speaker"),s.track}throw Error("Failed to get screen share track")}catch(e){throw Error("Failed to start screen sharing: ".concat(e instanceof Error?e.message:"Unknown error"))}}async stopScreenShare(){try{let t=this.liveKit.getRoom();if(!(null==t?void 0:t.localParticipant))throw Error("Not connected to a room");if(await t.localParticipant.setScreenShareEnabled(!1),this.state.screenShareTrack){let s=(this.state.participants.get(t.localParticipant.identity)||[]).filter(e=>e.track!==this.state.screenShareTrack);if(this.state.participants.set(t.localParticipant.identity,s),this.state.screenShareTrack.sid){var e;null==(e=this.onVideoTrackUnsubscribed)||e.call(this,this.state.screenShareTrack.sid)}this.state.screenShareTrack=null,this.setLayoutMode("grid")}}catch(e){throw Error("Failed to stop screen sharing: ".concat(e instanceof Error?e.message:"Unknown error"))}}async switchCamera(e){this.state.localVideoTrack&&(await this.disableCamera(),await this.enableCamera(e))}async switchMicrophone(e){this.state.localAudioTrack&&(await this.disableMicrophone(),await this.enableMicrophone(e))}pinParticipant(e){this.state.pinnedParticipant=e,e&&"fullscreen"!==this.state.layoutMode?this.setLayoutMode("speaker"):e||"speaker"!==this.state.layoutMode||this.setLayoutMode("grid")}setLayoutMode(e){var t;this.state.layoutMode=e,this.updateGridLayout(),null==(t=this.onLayoutChanged)||t.call(this,e)}getAllVideoTracks(){let e=[];for(let t of this.state.participants.values())e.push(...t);return e}getParticipantVideoTracks(e){return this.state.participants.get(e)||[]}getState(){return{...this.state}}async cleanup(){try{this.state.localVideoTrack&&await this.disableCamera(),this.state.localAudioTrack&&await this.disableMicrophone(),this.state.screenShareTrack&&await this.stopScreenShare(),this.state={isVideoCall:!1,participants:new Map,localVideoTrack:null,localAudioTrack:null,screenShareTrack:null,pinnedParticipant:null,layoutMode:"grid",gridSize:{rows:1,cols:1}},await this.liveKit.disconnect()}catch(e){}}setEventHandlers(e){this.onVideoTrackSubscribed=e.onVideoTrackSubscribed,this.onVideoTrackUnsubscribed=e.onVideoTrackUnsubscribed,this.onLayoutChanged=e.onLayoutChanged,this.onParticipantVideoEnabled=e.onParticipantVideoEnabled,this.onDimensionsChanged=e.onDimensionsChanged}setupVideoEventListeners(e){e.on("trackSubscribed",(e,t,s)=>{if(e instanceof U.$t){var a;let r={trackSid:t.trackSid,participant:{identity:s.identity,name:s.name||s.identity},track:e,isLocal:!1,isScreenShare:t.source===U.CC.Source.ScreenShare},i=this.state.participants.get(s.identity)||[];i.push(r),this.state.participants.set(s.identity,i),null==(a=this.onVideoTrackSubscribed)||a.call(this,r),this.updateGridLayout()}}),e.on("trackUnsubscribed",(e,t,s)=>{if(e instanceof U.$t){var a;let e=(this.state.participants.get(s.identity)||[]).filter(e=>e.trackSid!==t.trackSid);0===e.length?this.state.participants.delete(s.identity):this.state.participants.set(s.identity,e),null==(a=this.onVideoTrackUnsubscribed)||a.call(this,t.trackSid),this.updateGridLayout()}}),e.on("participantDisconnected",e=>{this.state.participants.delete(e.identity),this.updateGridLayout(),this.state.pinnedParticipant===e.identity&&this.pinParticipant(null)})}updateGridLayout(){let e=this.getAllVideoTracks().length;if(0===e){this.state.gridSize={rows:1,cols:1};return}let t=Math.ceil(Math.sqrt(e)),s=Math.ceil(e/t);this.state.gridSize={rows:s,cols:t}}constructor(){this.liveKit=D(),this.state={isVideoCall:!1,participants:new Map,localVideoTrack:null,localAudioTrack:null,screenShareTrack:null,pinnedParticipant:null,layoutMode:"grid",gridSize:{rows:1,cols:1}}}}let ed=null;class eh{async getAvailableSources(){try{if(navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices){let e=[{id:"screen",name:"Entire Screen",type:"screen"},{id:"window",name:"Application Window",type:"window"}];return this.state.availableSources=e,e}throw Error("Screen sharing not supported in this browser")}catch(e){throw Error("Failed to get available sources: ".concat(e instanceof Error?e.message:"Unknown error"))}}async startSourceSelection(){try{return this.state.isSelectingSource=!0,await this.getAvailableSources()}catch(e){throw this.state.isSelectingSource=!1,e}}cancelSourceSelection(){this.state.isSelectingSource=!1,this.state.availableSources=[]}async selectAndStartSharing(e){try{var t,s;this.state.selectedSource=e,this.state.isSelectingSource=!1;let a=this.liveKit.getRoom();if(!(null==a?void 0:a.localParticipant))throw Error("Not connected to a room");let r={audio:!0};"screen"===e.type?r.video={displaySurface:"monitor"}:r.video={displaySurface:"window"};let i=await this.videoCall.startScreenShare(),n={trackSid:i.sid||"",participant:{identity:a.localParticipant.identity,name:a.localParticipant.name||a.localParticipant.identity},track:i,isLocal:!0,source:e};return this.state.isSharing=!0,this.state.activeTracks.set(a.localParticipant.identity,n),i.mediaStreamTrack.addEventListener("ended",()=>{this.handleTrackEnded(a.localParticipant.identity)}),null==(t=this.onScreenShareStarted)||t.call(this,n),null==(s=this.onSourceSelected)||s.call(this,e),n}catch(e){throw this.state.isSelectingSource=!1,this.state.selectedSource=null,Error("Failed to start screen sharing: ".concat(e instanceof Error?e.message:"Unknown error"))}}async stopScreenSharing(){try{let t=this.liveKit.getRoom();if(!(null==t?void 0:t.localParticipant))throw Error("Not connected to a room");await this.videoCall.stopScreenShare();let s=this.state.activeTracks.get(t.localParticipant.identity);if(s){var e;null==(e=this.onScreenShareStopped)||e.call(this,s.trackSid),this.state.activeTracks.delete(t.localParticipant.identity)}this.state.isSharing=!1,this.state.selectedSource=null,this.state.viewerState={isFullscreen:!1,zoomLevel:1,focusedTrack:null}}catch(e){throw Error("Failed to stop screen sharing: ".concat(e instanceof Error?e.message:"Unknown error"))}}focusTrack(e){var t;this.state.viewerState.focusedTrack=e,null==(t=this.onViewerStateChanged)||t.call(this,this.state.viewerState)}setZoomLevel(e){var t;this.state.viewerState.zoomLevel=Math.max(.5,Math.min(3,e)),null==(t=this.onViewerStateChanged)||t.call(this,this.state.viewerState)}async toggleFullscreen(e){try{var t;this.state.viewerState.isFullscreen?(document.exitFullscreen&&await document.exitFullscreen(),this.state.viewerState.isFullscreen=!1):e&&e.requestFullscreen&&(await e.requestFullscreen(),this.state.viewerState.isFullscreen=!0),null==(t=this.onViewerStateChanged)||t.call(this,this.state.viewerState)}catch(e){}}getActiveTracks(){return Array.from(this.state.activeTracks.values())}getTrackForParticipant(e){return this.state.activeTracks.get(e)||null}getState(){return{...this.state}}hasActiveShares(){return this.state.activeTracks.size>0}setEventHandlers(e){this.onScreenShareStarted=e.onScreenShareStarted,this.onScreenShareStopped=e.onScreenShareStopped,this.onSourceSelected=e.onSourceSelected,this.onViewerStateChanged=e.onViewerStateChanged}handleRemoteScreenShare(e,t,s){if(t.source===U.CC.Source.ScreenShare){var a;let r={trackSid:t.trackSid,participant:{identity:s.identity,name:s.name||s.identity},track:e,isLocal:!1};this.state.activeTracks.set(s.identity,r),null==(a=this.onScreenShareStarted)||a.call(this,r)}}handleRemoteScreenShareStopped(e,t){if(e.source===U.CC.Source.ScreenShare){let e=this.state.activeTracks.get(t.identity);if(e){var s;this.state.activeTracks.delete(t.identity),null==(s=this.onScreenShareStopped)||s.call(this,e.trackSid)}}}handleTrackEnded(e){let t=this.state.activeTracks.get(e);if(t&&t.isLocal){var s;this.state.isSharing=!1,this.state.selectedSource=null,this.state.activeTracks.delete(e),null==(s=this.onScreenShareStopped)||s.call(this,t.trackSid)}}setupEventListeners(){let e=this.liveKit.getRoom();e&&(e.on("trackSubscribed",(e,t,s)=>{e instanceof U.$t&&t.source===U.CC.Source.ScreenShare&&this.handleRemoteScreenShare(e,t,s)}),e.on("trackUnsubscribed",(e,t,s)=>{e instanceof U.$t&&t.source===U.CC.Source.ScreenShare&&this.handleRemoteScreenShareStopped(t,s)}),e.on("participantDisconnected",e=>{let t=this.state.activeTracks.get(e.identity);if(t){var s;this.state.activeTracks.delete(e.identity),null==(s=this.onScreenShareStopped)||s.call(this,t.trackSid)}}),document.addEventListener("fullscreenchange",()=>{var e;this.state.viewerState.isFullscreen=!!document.fullscreenElement,null==(e=this.onViewerStateChanged)||e.call(this,this.state.viewerState)}))}async cleanup(){this.state.isSharing&&await this.stopScreenSharing(),this.state={isSharing:!1,isSelectingSource:!1,availableSources:[],selectedSource:null,activeTracks:new Map,viewerState:{isFullscreen:!1,zoomLevel:1,focusedTrack:null}}}constructor(){this.liveKit=D(),this.videoCall=(ed||(ed=new eo),ed),this.state={isSharing:!1,isSelectingSource:!1,availableSources:[],selectedSource:null,activeTracks:new Map,viewerState:{isFullscreen:!1,zoomLevel:1,focusedTrack:null}}}}let em=null;function eu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{roomName:t,userId:s,autoSetupListeners:a=!0}=e,i=(0,r.useRef)(null),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(!1),[d,h]=(0,r.useState)([]),[m,u]=(0,r.useState)(null),[x,p]=(0,r.useState)([]),[g,f]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[y,j]=(0,r.useState)(1),[w,N]=(0,r.useState)(null),[S,k]=(0,r.useState)(null);(0,r.useEffect)(()=>{em||(em=new eh),i.current=em,a&&(i.current.setupEventListeners(),i.current.setEventHandlers({onScreenShareStarted:e=>{p(t=>[...t.filter(t=>t.participant.identity!==e.participant.identity),e]),f(!0),e.isLocal&&l(!0)},onScreenShareStopped:e=>{p(t=>{let s=t.filter(t=>t.trackSid!==e);f(s.length>0);let a=t.find(t=>t.trackSid===e);return(null==a?void 0:a.isLocal)&&(l(!1),u(null)),s})},onSourceSelected:e=>{u(e),o(!1)},onViewerStateChanged:e=>{v(e.isFullscreen),j(e.zoomLevel),N(e.focusedTrack)}}));let e=i.current.getState();return l(e.isSharing),o(e.isSelectingSource),h(e.availableSources),u(e.selectedSource),p(i.current.getActiveTracks()),f(i.current.hasActiveShares()),v(e.viewerState.isFullscreen),j(e.viewerState.zoomLevel),N(e.viewerState.focusedTrack),()=>{var e;(null==(e=i.current)?void 0:e.getState().isSharing)&&i.current.cleanup()}},[a]);let C=(0,r.useCallback)(async()=>{if(!i.current)throw Error("Screen share service not initialized");k(null);try{o(!0);let e=await i.current.startSourceSelection();return h(e),e}catch(e){throw k(e instanceof Error?e.message:"Failed to get available sources"),o(!1),e}},[]),E=(0,r.useCallback)(()=>{i.current&&(i.current.cancelSourceSelection(),o(!1),h([]),k(null))},[]),A=(0,r.useCallback)(async e=>{if(!i.current)throw Error("Screen share service not initialized");k(null);try{return await i.current.selectAndStartSharing(e)}catch(e){throw k(e instanceof Error?e.message:"Failed to start screen sharing"),e}},[]),T=(0,r.useCallback)(async()=>{if(i.current){k(null);try{await i.current.stopScreenSharing()}catch(e){throw k(e instanceof Error?e.message:"Failed to stop screen sharing"),e}}},[]),F=(0,r.useCallback)(async()=>{if(n)await T();else{let e=await C(),t=e[0];1===e.length&&t&&await A(t)}},[n,T,C,A]),M=(0,r.useCallback)(e=>{i.current&&i.current.focusTrack(e)},[]),U=(0,r.useCallback)(e=>{i.current&&i.current.setZoomLevel(e)},[]),P=(0,r.useCallback)(async e=>{i.current&&await i.current.toggleFullscreen(e)},[]),q=(0,r.useCallback)(()=>{U(Math.min(3,y+.25))},[y,U]),D=(0,r.useCallback)(()=>{U(Math.max(.5,y-.25))},[y,U]),R=(0,r.useCallback)(()=>{U(1)},[U]),L=(0,r.useCallback)(e=>i.current?i.current.getTrackForParticipant(e):null,[]),I=(0,r.useCallback)(e=>null!==L(e),[L]);return{isSharing:n,isSelectingSource:c,availableSources:d,selectedSource:m,activeTracks:x,hasActiveShares:g,isViewerFullscreen:b,viewerZoomLevel:y,focusedTrack:w,startSourceSelection:C,cancelSourceSelection:E,selectAndStartSharing:A,stopScreenSharing:T,toggleScreenShare:F,focusTrack:M,setZoomLevel:U,toggleViewerFullscreen:P,zoomIn:q,zoomOut:D,resetZoom:R,getTrackForParticipant:L,isParticipantSharing:I,error:S,clearError:(0,r.useCallback)(()=>{k(null)},[])}}var ex=s(21438),ep=s(42147);function eg(e){let{source:t,isSelected:s,isLoading:i,onClick:n}=e,l=(0,r.useCallback)(()=>{i||n(t)},[t,i,n]),c=(0,r.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),l())},[l]);return(0,a.jsxs)("div",{role:"button",tabIndex:0,onClick:l,onKeyDown:c,className:(0,Z.cn)("relative flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all","hover:bg-[#3c3f45]/50 focus:outline-none focus:ring-2 focus:ring-blue-400",s?"border-blue-500 bg-blue-500/10":"border-[#40444b] hover:border-[#5a5d65]",i&&"opacity-70 cursor-not-allowed"),"aria-pressed":s,children:[(0,a.jsx)("div",{className:(0,Z.cn)("flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center","screen"===t.type?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:"screen"===t.type?(0,a.jsx)(_.A,{className:"w-6 h-6"}):(0,a.jsx)(ex.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-white",children:t.name}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"screen"===t.type?"Share your entire screen with all open applications":"Share a specific application window"})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:i?(0,a.jsx)(el.A,{className:"w-5 h-5 text-blue-400 animate-spin"}):s?(0,a.jsx)(ep.A,{className:"w-5 h-5 text-blue-400"}):null}),t.thumbnail&&(0,a.jsx)("div",{className:"absolute top-2 right-2 w-16 h-10 bg-[#2f3136] rounded border border-[#40444b] overflow-hidden",children:(0,a.jsx)("img",{src:URL.createObjectURL(t.thumbnail),alt:"Preview",className:"w-full h-full object-cover"})})]})}function ef(e){let{isOpen:t,onSourceSelect:s,onCancel:i,error:n,className:l=""}=e,{availableSources:c,startSourceSelection:o,cancelSourceSelection:d,selectAndStartSharing:h,isSelectingSource:m,clearError:u}=eu(),[x,p]=(0,r.useState)(null),[g,f]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&0===c.length&&y()},[t]),(0,r.useEffect)(()=>{t&&(v(null),u())},[t,u]);let y=(0,r.useCallback)(async()=>{try{f(!0),v(null),await o()}catch(e){v(e instanceof Error?e.message:"Failed to load screen share sources")}finally{f(!1)}},[o]),j=(0,r.useCallback)(e=>{p(e)},[]),N=(0,r.useCallback)(async()=>{if(x)try{f(!0),v(null),await h(x),s(x)}catch(e){v(e instanceof Error?e.message:"Failed to start screen sharing"),f(!1)}},[x,h,s]),S=(0,r.useCallback)(()=>{d(),p(null),v(null),i()},[d,i]),k=(0,r.useCallback)(e=>{e.target===e.currentTarget&&S()},[S]),C=n||b;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"screenshare-title",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:k,"aria-hidden":"true"}),(0,a.jsxs)("div",{className:(0,Z.cn)("relative w-full max-w-md mx-4 bg-[#1e1f22] rounded-lg shadow-2xl border border-[#2d2f34]","max-h-[80vh] flex flex-col",l),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-[#2d2f34]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{id:"screenshare-title",className:"text-lg font-semibold text-white",children:"Share Your Screen"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Choose what to share with others in the call"})]}),(0,a.jsx)("button",{onClick:S,className:"text-gray-400 hover:text-white transition-colors rounded-lg p-1 hover:bg-[#3c3f45]","aria-label":"Close dialog",children:(0,a.jsx)(w.A,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto",children:[C&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-start gap-3",children:[(0,a.jsx)(J.A,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-400",children:"Screen Share Error"}),(0,a.jsx)("p",{className:"text-xs text-red-300 mt-1",children:C})]})]}),g&&!c.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,a.jsx)(el.A,{className:"w-8 h-8 text-blue-400 animate-spin mb-3"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Loading available sources..."})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[c.map(e=>(0,a.jsx)(eg,{source:e,isSelected:(null==x?void 0:x.id)===e.id,isLoading:g&&(null==x?void 0:x.id)===e.id,onClick:j},e.id)),0===c.length&&!g&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(_.A,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"No sources available"}),(0,a.jsx)("button",{onClick:y,className:"text-sm text-blue-400 hover:text-blue-300 mt-2",children:"Try again"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-[#2d2f34]",children:[(0,a.jsx)("button",{onClick:S,disabled:g,className:"px-4 py-2 text-sm text-gray-300 hover:text-white transition-colors disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:N,disabled:!x||g,className:(0,Z.cn)("px-4 py-2 text-sm font-medium rounded-lg transition-colors","focus:outline-none focus:ring-2 focus:ring-blue-400","disabled:opacity-50 disabled:cursor-not-allowed",x&&!g?"bg-blue-600 hover:bg-blue-700 text-white":"bg-[#3c3f45] text-gray-400 cursor-not-allowed"),children:g?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(el.A,{className:"w-4 h-4 animate-spin"}),"Starting..."]}):"Share"})]})]})]}):null}function eb(e){let{variant:t="default",className:s="",size:i="md",showDropdown:n=!0,tooltip:l,disabled:c=!1,onSharingStart:o,onSharingStop:d,onError:h}=e,{isSharing:m,isSelectingSource:u,startSourceSelection:x,stopScreenSharing:p,error:f,clearError:b}=eu(),[v,y]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),N=(0,r.useCallback)(async()=>{if(m){w(!0);try{await p(),null==d||d()}catch(t){let e=t instanceof Error?t.message:"Failed to stop screen sharing";null==h||h(e)}finally{w(!1)}}else{w(!0);try{y(!0)}catch(t){let e=t instanceof Error?t.message:"Failed to start screen sharing";null==h||h(e),w(!1)}}},[m,p,d,h]),S=(0,r.useCallback)(async e=>{e.stopPropagation(),m?await N():y(!0)},[m,N]),k=(0,r.useCallback)(e=>{y(!1),w(!1),null==o||o(e),b()},[o,b]),C=(0,r.useCallback)(()=>{y(!1),w(!1),b()},[b]),E=()=>{switch(i){case"sm":return"h-8 px-2";case"lg":return"h-12 px-4";default:return"h-10 px-3"}},A=()=>{switch(i){case"sm":return"w-4 h-4";case"lg":return"w-6 h-6";default:return"w-5 h-5"}},T=l||(m?"Stop screen sharing":"Share your screen");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,Z.cn)("flex items-center",s),children:[(0,a.jsxs)("button",{onClick:N,disabled:c||j,className:(0,Z.cn)((()=>{let e=(0,Z.cn)("transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#2f3136]",c&&"opacity-50 cursor-not-allowed");return"compact"===t?(0,Z.cn)(e,"rounded-lg"):"floating"===t?(0,Z.cn)(e,"rounded-full shadow-lg"):(0,Z.cn)(e,n?"rounded-l-lg":"rounded-lg")})(),m?"bg-green-600 hover:bg-green-700 text-white focus:ring-green-400":u||j?"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-400":"bg-[#3c3f45] hover:bg-[#4a4d55] text-white focus:ring-white/20",E(),"flex items-center justify-center gap-2"),title:T,"aria-label":T,"aria-pressed":m,role:"switch",children:[j||u?(0,a.jsx)(el.A,{className:(0,Z.cn)(A(),"animate-spin")}):m?(0,a.jsx)(_.A,{className:A()}):(0,a.jsx)(ec.A,{className:A()}),"compact"!==t&&"sm"!==i&&(0,a.jsx)("span",{className:"text-sm font-medium",children:m?"Sharing":"Share Screen"})]}),n&&"compact"!==t&&(0,a.jsx)("button",{onClick:S,disabled:c||j,className:(()=>{let e=(0,Z.cn)("rounded-r-lg border-l transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#2f3136]",E().split(" ")[0],"px-2");return m?(0,Z.cn)(e,"bg-green-600 hover:bg-green-700 border-green-500 text-white"):u||j?(0,Z.cn)(e,"bg-blue-600 hover:bg-blue-700 border-blue-500 text-white"):(0,Z.cn)(e,"bg-[#3c3f45] hover:bg-[#4a4d55] border-[#5a5d65] text-white")})(),title:"Screen share options","aria-label":"Screen share options",children:(0,a.jsx)(g.A,{className:"w-3 h-3"})})]}),v&&(0,a.jsx)(ef,{isOpen:v,onSourceSelect:k,onCancel:C,error:f})]})}function ev(e){let{onClick:t,isActive:s,tooltip:r,children:i,variant:n="default","aria-pressed":l,disabled:c=!1}=e;return(0,a.jsx)("button",{onClick:c?void 0:t,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),c||t())},className:(()=>{let e=(0,Z.cn)("w-10 h-10 rounded-full transition-all flex items-center justify-center","focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#2f3136]",c&&"opacity-50 cursor-not-allowed");return"danger"===n?(0,Z.cn)(e,"bg-red-500 hover:bg-red-600 text-white focus:ring-red-400"):"success"===n?(0,Z.cn)(e,"bg-green-600 hover:bg-green-700 text-white focus:ring-green-400"):!1===s?(0,Z.cn)(e,"bg-red-500/80 hover:bg-red-500 text-white focus:ring-red-400"):(0,Z.cn)(e,"bg-[#3c3f45] hover:bg-[#4a4d55] text-white focus:ring-white/20")})(),title:r,"aria-label":r,"aria-pressed":l,disabled:c,role:"switch",children:i})}function ey(e){let{roomName:t,userId:s,className:i="",onSettingsClick:n,compact:l=!1}=e,{isConnected:c,isAudioEnabled:o,isVideoEnabled:d,toggleAudio:h,toggleVideo:m,disconnect:u}=z({roomName:t||"",userId:s||""}),{isDeafened:x,setDeafened:p}=V();(0,r.useEffect)(()=>{let e=e=>{!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key&&(e.preventDefault(),h()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),g()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"V"===e.key&&(e.preventDefault(),m()))};if(c)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,h,m]);let g=(0,r.useCallback)(()=>{let e=!x;p(e),e&&o&&h()},[x,p,o,h]),f=(0,r.useCallback)(()=>{u()},[u]);return c?l?(0,a.jsxs)("div",{className:(0,Z.cn)("flex items-center gap-1 p-1 rounded bg-[#232428]",i),role:"toolbar","aria-label":"Voice controls",children:[(0,a.jsx)(ev,{onClick:h,isActive:o,tooltip:o?"Mute (Ctrl+Shift+M)":"Unmute (Ctrl+Shift+M)","aria-pressed":!o,children:o?(0,a.jsx)(ea.A,{className:"w-4 h-4"}):(0,a.jsx)(B.A,{className:"w-4 h-4"})}),(0,a.jsx)(ev,{onClick:g,isActive:!x,tooltip:x?"Undeafen (Ctrl+Shift+D)":"Deafen (Ctrl+Shift+D)","aria-pressed":x,children:x?(0,a.jsx)(er.A,{className:"w-4 h-4"}):(0,a.jsx)(ei.A,{className:"w-4 h-4"})}),(0,a.jsx)(eb,{variant:"compact",size:"sm",showDropdown:!1,className:"w-8 h-8 min-w-8"}),(0,a.jsx)(ev,{onClick:f,tooltip:"Disconnect",variant:"danger",children:(0,a.jsx)(en.A,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:(0,Z.cn)("fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50","flex items-center gap-2 px-4 py-3 rounded-xl","bg-[#1e1f22]/95 backdrop-blur-sm border border-[#2d2f34]","shadow-lg shadow-black/30",i),role:"toolbar","aria-label":"Voice controls",children:[(0,a.jsx)(ev,{onClick:h,isActive:o,tooltip:o?"Mute (Ctrl+Shift+M)":"Unmute (Ctrl+Shift+M)","aria-pressed":!o,children:o?(0,a.jsx)(ea.A,{className:"w-5 h-5"}):(0,a.jsx)(B.A,{className:"w-5 h-5"})}),(0,a.jsx)(ev,{onClick:g,isActive:!x,tooltip:x?"Undeafen (Ctrl+Shift+D)":"Deafen (Ctrl+Shift+D)","aria-pressed":x,children:x?(0,a.jsx)(er.A,{className:"w-5 h-5"}):(0,a.jsx)(ei.A,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"w-px h-6 bg-[#3c3f45] mx-1","aria-hidden":"true"}),(0,a.jsx)(ev,{onClick:m,isActive:d,tooltip:d?"Turn off camera (Ctrl+Shift+V)":"Turn on camera (Ctrl+Shift+V)","aria-pressed":d,children:d?(0,a.jsx)(Y.A,{className:"w-5 h-5"}):(0,a.jsx)(Q.A,{className:"w-5 h-5"})}),(0,a.jsx)(eb,{variant:"default",size:"md",showDropdown:!0}),(0,a.jsx)("div",{className:"w-px h-6 bg-[#3c3f45] mx-1","aria-hidden":"true"}),n&&(0,a.jsx)(ev,{onClick:n,tooltip:"Voice Settings",children:(0,a.jsx)(v.A,{className:"w-5 h-5"})}),(0,a.jsx)(ev,{onClick:f,tooltip:"Disconnect",variant:"danger",children:(0,a.jsx)(en.A,{className:"w-5 h-5"})})]}):null}var ej=s(19197),ew=s(49508),eN=s(1006),eS=s(38565),ek=s(91324);let eC=(0,R.vt)()((0,L.Zr)(e=>({userId:null,displayName:null,avatarUrl:null,isAuthenticated:!1,setUser:t=>e(e=>({...e,...t,isAuthenticated:!!t.userId})),clearUser:()=>e({userId:null,displayName:null,avatarUrl:null,isAuthenticated:!1})}),{name:"haos-matrix-user",version:1}));var eE=s(91699);class eA extends eE.EventEmitter{initialize(e){this.currentUserId=e,this.loadFriendsFromStorage()}async sendFriendRequest(e,t,s){if(!this.currentUserId)throw Error("User not authenticated");if(e===this.currentUserId)throw Error("Cannot send friend request to yourself");if(this.friends.has(e))throw Error("User is already a friend");if(this.outgoingRequests.has(e))throw Error("Friend request already sent to this user");try{let a={id:"req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),fromUserId:this.currentUserId,toUserId:e,fromDisplayName:t,fromAvatarUrl:s,status:"pending",timestamp:new Date};await this.simulateMatrixFriendRequest(a),this.outgoingRequests.set(e,a),this.saveFriendsToStorage(),this.emit("friend-request-sent",a)}catch(e){throw this.emit("error",e),e}}async acceptFriendRequest(e){let t=Array.from(this.incomingRequests.values()).find(t=>t.id===e);if(!t)throw Error("Friend request not found");try{t.status="accepted";let e={userId:t.fromUserId,displayName:t.fromDisplayName,avatarUrl:t.fromAvatarUrl,status:"online",addedAt:new Date};this.friends.set(t.fromUserId,e),this.incomingRequests.delete(t.fromUserId),this.saveFriendsToStorage(),await this.simulateMatrixAcceptance(t),this.emit("friend-request-accepted",t),this.emit("friend-added",e)}catch(e){throw this.emit("error",e),e}}async declineFriendRequest(e){let t=Array.from(this.incomingRequests.values()).find(t=>t.id===e);if(!t)throw Error("Friend request not found");try{t.status="declined",this.incomingRequests.delete(t.fromUserId),this.saveFriendsToStorage(),await this.simulateMatrixDecline(t),this.emit("friend-request-declined",t)}catch(e){throw this.emit("error",e),e}}async removeFriend(e){if(!this.friends.has(e))throw Error("User is not a friend");try{this.friends.delete(e),this.saveFriendsToStorage(),await this.simulateMatrixRemoval(e),this.emit("friend-removed",e)}catch(e){throw this.emit("error",e),e}}getFriends(){return Array.from(this.friends.values())}getIncomingRequests(){return Array.from(this.incomingRequests.values())}getOutgoingRequests(){return Array.from(this.outgoingRequests.values())}getFriend(e){return this.friends.get(e)}isFriend(e){return this.friends.has(e)}hasPendingRequest(e){return this.outgoingRequests.has(e)}updateFriendStatus(e,t){let s=this.friends.get(e);s&&(s.status=t,"offline"===t&&(s.lastSeen=new Date),this.friends.set(e,s),this.saveFriendsToStorage(),this.emit("friend-status-changed",{userId:e,status:t}))}async searchUsers(e){return[{userId:"@alice:matrix.org",displayName:"Alice Johnson",avatarUrl:void 0},{userId:"@bob:matrix.org",displayName:"Bob Smith",avatarUrl:void 0},{userId:"@charlie:matrix.org",displayName:"Charlie Brown",avatarUrl:void 0}].filter(t=>t.displayName.toLowerCase().includes(e.toLowerCase())||t.userId.toLowerCase().includes(e.toLowerCase()))}loadFriendsFromStorage(){try{let e=localStorage.getItem("haos-friends");if(e){let t=JSON.parse(e);t.friends&&(this.friends=new Map(t.friends.map(e=>[e.userId,{...e,addedAt:new Date(e.addedAt),lastSeen:e.lastSeen?new Date(e.lastSeen):void 0}]))),t.incomingRequests&&(this.incomingRequests=new Map(t.incomingRequests.map(e=>[e.fromUserId,{...e,timestamp:new Date(e.timestamp)}]))),t.outgoingRequests&&(this.outgoingRequests=new Map(t.outgoingRequests.map(e=>[e.toUserId,{...e,timestamp:new Date(e.timestamp)}])))}}catch(e){console.error("Failed to load friends from storage:",e)}}saveFriendsToStorage(){try{let e={friends:Array.from(this.friends.values()),incomingRequests:Array.from(this.incomingRequests.values()),outgoingRequests:Array.from(this.outgoingRequests.values())};localStorage.setItem("haos-friends",JSON.stringify(e))}catch(e){console.error("Failed to save friends to storage:",e)}}async simulateMatrixFriendRequest(e){await new Promise(e=>setTimeout(e,500)),console.log("Sent friend request via Matrix:",e)}async simulateMatrixAcceptance(e){await new Promise(e=>setTimeout(e,300)),console.log("Sent friend acceptance via Matrix:",e)}async simulateMatrixDecline(e){await new Promise(e=>setTimeout(e,300)),console.log("Sent friend decline via Matrix:",e)}async simulateMatrixRemoval(e){await new Promise(e=>setTimeout(e,300)),console.log("Sent friend removal via Matrix:",e)}dispose(){this.removeAllListeners()}simulateIncomingRequest(e,t,s){let a={id:"req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),fromUserId:e,toUserId:this.currentUserId||"current-user",fromDisplayName:t,fromAvatarUrl:s,status:"pending",timestamp:new Date};this.incomingRequests.set(e,a),this.saveFriendsToStorage(),this.emit("friend-request-received",a)}constructor(){super(),this.friends=new Map,this.outgoingRequests=new Map,this.incomingRequests=new Map,this.currentUserId=null,this.loadFriendsFromStorage()}}let eT=null;function eF(){return eT||(eT=new eA),eT}function eM(e){let{open:t,onOpenChange:s,targetUserId:i}=e,{userId:n,displayName:l,avatarUrl:o}=eC(),[d,h]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[g,f]=(0,r.useState)(""),[b,v]=(0,r.useState)([]),[N,S]=(0,r.useState)(!1),[k,C]=(0,r.useState)("overview"),E=eF(),A=!i||i===n;(0,r.useEffect)(()=>{t&&A&&T()},[t,A]),(0,r.useEffect)(()=>{if(!t)return;let e=e=>{h(t=>[...t,e])},s=e=>{h(t=>t.filter(t=>t.userId!==e))},a=e=>{u(t=>[...t,e])},r=e=>{p(t=>[...t,e])},i=e=>{u(t=>t.filter(t=>t.id!==e.id)),p(t=>t.filter(t=>t.id!==e.id))},n=e=>{u(t=>t.filter(t=>t.id!==e.id))};return E.on("friend-added",e),E.on("friend-removed",s),E.on("friend-request-received",a),E.on("friend-request-sent",r),E.on("friend-request-accepted",i),E.on("friend-request-declined",n),()=>{E.off("friend-added",e),E.off("friend-removed",s),E.off("friend-request-received",a),E.off("friend-request-sent",r),E.off("friend-request-accepted",i),E.off("friend-request-declined",n)}},[t,E]);let T=()=>{h(E.getFriends()),u(E.getIncomingRequests()),p(E.getOutgoingRequests())},M=async()=>{if(g.trim()){S(!0);try{let e=await E.searchUsers(g);v(e)}catch(e){console.error("Search failed:",e)}finally{S(!1)}}},U=async(e,t,s)=>{try{await E.sendFriendRequest(e,t,s),v(t=>t.filter(t=>t.userId!==e))}catch(e){console.error("Failed to send friend request:",e)}},P=async e=>{try{await E.acceptFriendRequest(e)}catch(e){console.error("Failed to accept friend request:",e)}},q=async e=>{try{await E.declineFriendRequest(e)}catch(e){console.error("Failed to decline friend request:",e)}},D=async e=>{if(confirm("Are you sure you want to remove this friend?"))try{await E.removeFriend(e)}catch(e){console.error("Failed to remove friend:",e)}},R=e=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2);return A?(0,a.jsx)(j.bL,{open:t,onOpenChange:s,children:(0,a.jsxs)(j.ZL,{children:[(0,a.jsx)(j.hJ,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),(0,a.jsx)(j.UC,{className:"fixed left-1/2 top-1/2 z-50 w-[90vw] max-w-4xl max-h-[90vh] -translate-x-1/2 -translate-y-1/2",children:(0,a.jsxs)("div",{className:"bg-discord-dark border border-gray-700 rounded-lg shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-discord-darker border-b border-gray-700 p-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary-500 flex items-center justify-center text-white text-lg font-semibold",children:o?(0,a.jsx)("img",{src:o,alt:l||"User",className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:R(l||"User")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j.hE,{className:"text-xl font-semibold text-white",children:l||"User Profile"}),(0,a.jsx)(j.VY,{className:"text-gray-400 text-sm",children:n})]})]}),(0,a.jsx)(j.bm,{className:"text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)(w.A,{className:"w-6 h-6"})})]}),(0,a.jsxs)(ej.bL,{value:k,onValueChange:C,children:[(0,a.jsxs)(ej.B8,{className:"flex border-b border-gray-700 bg-discord-darker",children:[(0,a.jsxs)(ej.l9,{value:"overview",className:"px-6 py-3 text-gray-400 hover:text-white data-[state=active]:text-white data-[state=active]:border-b-2 data-[state=active]:border-primary-500 transition-colors",children:[(0,a.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"Overview"]}),(0,a.jsxs)(ej.l9,{value:"friends",className:"px-6 py-3 text-gray-400 hover:text-white data-[state=active]:text-white data-[state=active]:border-b-2 data-[state=active]:border-primary-500 transition-colors",children:[(0,a.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Friends (",d.length,")"]}),(0,a.jsxs)(ej.l9,{value:"requests",className:"px-6 py-3 text-gray-400 hover:text-white data-[state=active]:text-white data-[state=active]:border-b-2 data-[state=active]:border-primary-500 transition-colors",children:[(0,a.jsx)(eN.A,{className:"w-4 h-4 mr-2"}),"Requests (",m.length,")"]})]}),(0,a.jsx)(ej.UC,{value:"overview",className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-primary-500 flex items-center justify-center text-white text-3xl font-semibold mx-auto mb-4",children:o?(0,a.jsx)("img",{src:o,alt:l||"User",className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:R(l||"User")})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold text-white mb-2",children:l}),(0,a.jsx)("p",{className:"text-gray-400",children:n})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-discord-darker p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:"Friends"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-primary-500",children:d.length})]}),(0,a.jsxs)("div",{className:"bg-discord-darker p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:"Pending Requests"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-500",children:m.length})]})]})]})}),(0,a.jsx)(ej.UC,{value:"friends",className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-discord-darker p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-3",children:"Add Friends"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(eS.A,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by username or display name...",value:g,onChange:e=>f(e.target.value),onKeyPress:e=>"Enter"===e.key&&M(),className:"w-full bg-[#1e1f22] border border-gray-600 rounded px-10 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-primary-500"})]}),(0,a.jsx)("button",{onClick:M,disabled:N||!g.trim(),className:"bg-primary-500 hover:bg-primary-600 disabled:bg-gray-600 text-white px-4 py-2 rounded transition-colors",children:N?"Searching...":"Search"})]}),b.length>0&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-gray-400",children:"Search Results"}),b.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-[#1e1f22] rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white text-sm font-semibold",children:e.avatarUrl?(0,a.jsx)("img",{src:e.avatarUrl,alt:e.displayName,className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:R(e.displayName)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white text-sm font-medium",children:e.displayName}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:e.userId})]})]}),(0,a.jsx)("button",{onClick:()=>U(e.userId,e.displayName,e.avatarUrl),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors",children:"Add Friend"})]},e.userId))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-3",children:"Your Friends"}),0===d.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,a.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{children:"No friends yet. Search for users above to send friend requests!"})]}):(0,a.jsx)("div",{className:"space-y-2",children:d.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-discord-darker rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold",children:e.avatarUrl?(0,a.jsx)("img",{src:e.avatarUrl,alt:e.displayName,className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:R(e.displayName)})}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-discord-darker ".concat((e=>{switch(e){case"online":return"bg-green-500";case"away":return"bg-yellow-500";case"busy":return"bg-red-500";default:return"bg-gray-500"}})(e.status))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.displayName}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:e.status})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>console.log("Message",e.userId),className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded transition-colors",title:"Send message",children:(0,a.jsx)(ew.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>D(e.userId),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded transition-colors",title:"Remove friend",children:(0,a.jsx)(ek.A,{className:"w-4 h-4"})})]})]},e.userId))})]})]})}),(0,a.jsx)(ej.UC,{value:"requests",className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-white font-medium mb-3",children:["Incoming Requests (",m.length,")"]}),0===m.length?(0,a.jsxs)("div",{className:"text-center py-6 text-gray-400",children:[(0,a.jsx)(eN.A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No incoming friend requests"})]}):(0,a.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-discord-darker rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold",children:e.fromAvatarUrl?(0,a.jsx)("img",{src:e.fromAvatarUrl,alt:e.fromDisplayName,className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:R(e.fromDisplayName)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.fromDisplayName}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:e.fromUserId})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>P(e.id),className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded transition-colors",title:"Accept",children:(0,a.jsx)(ep.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>q(e.id),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded transition-colors",title:"Decline",children:(0,a.jsx)(ek.A,{className:"w-4 h-4"})})]})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-white font-medium mb-3",children:["Sent Requests (",x.length,")"]}),0===x.length?(0,a.jsx)("div",{className:"text-center py-6 text-gray-400",children:(0,a.jsx)("p",{children:"No sent friend requests"})}):(0,a.jsx)("div",{className:"space-y-2",children:x.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-discord-darker rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-500 flex items-center justify-center text-white font-semibold",children:(0,a.jsx)("span",{children:R(e.toUserId)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.toUserId}),(0,a.jsx)("div",{className:"text-yellow-400 text-sm",children:"Request sent"})]})]}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:e.timestamp.toLocaleDateString()})]},e.id))})]})]})})]})]})})]})}):(0,a.jsx)(j.bL,{open:t,onOpenChange:s,children:(0,a.jsxs)(j.ZL,{children:[(0,a.jsx)(j.hJ,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),(0,a.jsx)(j.UC,{className:"fixed left-1/2 top-1/2 z-50 w-[90vw] max-w-md max-h-[90vh] -translate-x-1/2 -translate-y-1/2",children:(0,a.jsxs)("div",{className:"bg-discord-dark border border-gray-700 rounded-lg shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-discord-darker border-b border-gray-700 p-6 flex items-center justify-between",children:[(0,a.jsx)(j.hE,{className:"text-xl font-semibold text-white",children:"User Profile"}),(0,a.jsx)(j.bm,{className:"text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)(w.A,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-primary-500 flex items-center justify-center text-white text-2xl font-semibold mx-auto mb-4",children:R(i||"Unknown")}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:i}),(0,a.jsx)("p",{className:"text-gray-400 mb-6",children:"Matrix User"}),(0,a.jsx)("div",{className:"space-y-3",children:E.isFriend(i)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors flex items-center justify-center gap-2",onClick:()=>console.log("Send message to",i),children:[(0,a.jsx)(ew.A,{className:"w-4 h-4"}),"Send Message"]}),(0,a.jsx)("button",{className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors",onClick:()=>D(i),children:"Remove Friend"})]}):E.hasPendingRequest(i)?(0,a.jsx)("div",{className:"text-yellow-400 text-sm",children:"Friend request sent"}):(0,a.jsxs)("button",{className:"w-full bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded transition-colors flex items-center justify-center gap-2",onClick:()=>U(i,i,void 0),children:[(0,a.jsx)(F.A,{className:"w-4 h-4"}),"Send Friend Request"]})})]})]})})]})})}var eU=s(65887);function eP(e){let{friends:t,incomingRequests:s,onMessageFriend:i,onOpenUserProfile:n,className:l="",compact:o=!1}=e,[d,h]=(0,r.useState)(!0),[m,u]=(0,r.useState)(!1),x=e=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2),p=e=>{switch(e){case"online":return"bg-green-500";case"away":return"bg-yellow-500";case"busy":return"bg-red-500";default:return"bg-gray-500"}},b=t.filter(e=>"online"===e.status||"away"===e.status||"busy"===e.status),v=t.filter(e=>"offline"===e.status);return o?(0,a.jsxs)("div",{className:"space-y-1 ".concat(l),children:[(0,a.jsx)("button",{onClick:()=>u(!0),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-gray-400 hover:text-gray-200 uppercase tracking-wide",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),"Friends (",t.length,")",s.length>0&&(0,a.jsx)("span",{className:"bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full min-w-[18px] text-center",children:s.length})]})}),b.slice(0,5).map(e=>(0,a.jsxs)("button",{onClick:()=>null==n?void 0:n(e.userId),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded text-gray-400 hover:text-gray-200 hover:bg-[#36393f] transition-colors",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-primary-500 flex items-center justify-center text-white text-xs font-semibold",children:e.avatarUrl?(0,a.jsx)("img",{src:e.avatarUrl,alt:e.displayName,className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:x(e.displayName)})}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full border border-[#2f3136] ".concat(p(e.status))})]}),(0,a.jsx)("span",{className:"flex-1 truncate text-sm text-left",children:e.displayName}),i&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),i(e)},className:"opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-opacity",title:"Send message",children:(0,a.jsx)(ew.A,{className:"w-3 h-3"})})]},e.userId)),t.length>5&&(0,a.jsx)("button",{onClick:()=>u(!0),className:"w-full px-2 py-1.5 text-xs text-gray-400 hover:text-gray-200 text-center",children:"View all friends..."}),(0,a.jsx)(eM,{open:m,onOpenChange:u})]}):(0,a.jsxs)("div",{className:"space-y-4 ".concat(l),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-white font-semibold",children:"Friends"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-red-500 text-white px-2 py-1 rounded text-xs",children:[(0,a.jsx)(eN.A,{className:"w-3 h-3"}),s.length," request",1!==s.length?"s":""]}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"bg-primary-500 hover:bg-primary-600 text-white p-1.5 rounded transition-colors",title:"Manage friends",children:(0,a.jsx)(F.A,{className:"w-4 h-4"})})]})]}),0===t.length?(0,a.jsxs)("div",{className:"text-center py-6 text-gray-400",children:[(0,a.jsx)(c.A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"mb-2",children:"No friends yet"}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded text-sm transition-colors",children:"Add Friends"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[b.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:()=>h(!d),className:"flex items-center gap-1 text-xs font-semibold text-gray-400 hover:text-gray-200 uppercase tracking-wide mb-2",children:[d?(0,a.jsx)(g.A,{className:"w-3 h-3"}):(0,a.jsx)(f.A,{className:"w-3 h-3"}),"Online (",b.length,")"]}),d&&(0,a.jsx)("div",{className:"space-y-1",children:b.map(e=>(0,a.jsxs)("div",{className:"group flex items-center justify-between p-2 hover:bg-[#36393f] rounded transition-colors",children:[(0,a.jsxs)("button",{onClick:()=>null==n?void 0:n(e.userId),className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white text-sm font-semibold",children:e.avatarUrl?(0,a.jsx)("img",{src:e.avatarUrl,alt:e.displayName,className:"w-full h-full rounded-full object-cover"}):(0,a.jsx)("span",{children:x(e.displayName)})}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-[#36393f] ".concat(p(e.status))})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-white text-sm font-medium truncate",children:e.displayName}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:(e=>{switch(e){case"online":return"Online";case"away":return"Away";case"busy":return"Busy";default:return"Offline"}})(e.status)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i&&(0,a.jsx)("button",{onClick:()=>i(e),className:"p-1.5 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors",title:"Send message",children:(0,a.jsx)(ew.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{className:"p-1.5 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors",title:"More options",children:(0,a.jsx)(eU.A,{className:"w-4 h-4"})})]})]},e.userId))})]}),v.length>0&&(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2",children:[(0,a.jsx)(f.A,{className:"w-3 h-3"}),"Offline (",v.length,")"]})})]}),(0,a.jsx)(eM,{open:m,onOpenChange:u})]})}var eq=s(74573);function eD(){let{client:e,isCryptoReady:t,isAuthenticated:s,isLoading:r,error:i}=(0,eq.j)();return(0,a.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg space-y-2 text-sm font-mono",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-white mb-2",children:"\uD83D\uDD10 Crypto Debug"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Loading: "}),(0,a.jsx)("span",{className:r?"text-yellow-500":"text-green-500",children:r?"true":"false"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Authenticated: "}),(0,a.jsx)("span",{className:s?"text-green-500":"text-red-500",children:s?"true":"false"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Client: "}),(0,a.jsx)("span",{className:e?"text-green-500":"text-red-500",children:e?"connected":"null"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Crypto Ready: "}),(0,a.jsx)("span",{className:t?"text-green-500":"text-yellow-500",children:t?"true":"false"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Crypto Enabled: "}),(0,a.jsx)("span",{className:(null==e?void 0:e.isCryptoEnabled())?"text-green-500":"text-red-500",children:(null==e?void 0:e.isCryptoEnabled())?"true":"false"})]}),i&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Error: "}),(0,a.jsx)("span",{className:"text-red-500",children:i})]}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"User ID: "}),(0,a.jsx)("span",{className:"text-blue-400",children:e.getUserId()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Device ID: "}),(0,a.jsx)("span",{className:"text-blue-400",children:e.getDeviceId()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Homeserver: "}),(0,a.jsx)("span",{className:"text-blue-400",children:e.baseUrl})]})]})]})}let eR=[{id:"vc-1",name:"General",participantCount:0,participants:[]},{id:"vc-2",name:"Gaming",participantCount:2,participants:[{identity:"user-1",name:"Alice",isSpeaking:!0,isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharing:!1,isLocal:!1,connectionQuality:"excellent"},{identity:"user-2",name:"Bob",isSpeaking:!1,isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharing:!1,isLocal:!1,connectionQuality:"good"}]},{id:"vc-3",name:"Music",participantCount:0,isPrivate:!0,maxParticipants:10,participants:[]}],eL=[{id:"tc-1",name:"general",unread:5},{id:"tc-2",name:"announcements",unread:0},{id:"tc-3",name:"random",unread:12}];function eI(){let e=(0,x.useRouter)(),[t,s]=(0,r.useState)(!1),[i,n]=(0,r.useState)(!1),[o,h]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!0),[j,w]=(0,r.useState)(!0),{currentChannel:N,participants:S,connectionState:k}=V(),{userId:C,displayName:E,avatarUrl:T}=eC(),{friends:F,incomingRequests:M,addMockFriendRequest:U}=function(){let{userId:e}=eC(),[t,s]=(0,r.useState)([]),[a,i]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)(!1),[d,h]=(0,r.useState)(!1),m=eF();(0,r.useEffect)(()=>{e&&(m.initialize(e),u())},[e]),(0,r.useEffect)(()=>{let e=e=>{s(t=>[...t.filter(t=>t.userId!==e.userId),e])},t=e=>{s(t=>t.filter(t=>t.userId!==e))},a=e=>{i(t=>[...t.filter(t=>t.id!==e.id),e])},r=e=>{l(t=>[...t.filter(t=>t.id!==e.id),e])},n=e=>{i(t=>t.filter(t=>t.id!==e.id)),l(t=>t.filter(t=>t.id!==e.id))},c=e=>{i(t=>t.filter(t=>t.id!==e.id))},o=e=>{let{userId:t,status:a}=e;s(e=>e.map(e=>e.userId===t?{...e,status:a,lastSeen:"offline"===a?new Date:e.lastSeen}:e))},d=e=>{console.error("Friend service error:",e)};return m.on("friend-added",e),m.on("friend-removed",t),m.on("friend-request-received",a),m.on("friend-request-sent",r),m.on("friend-request-accepted",n),m.on("friend-request-declined",c),m.on("friend-status-changed",o),m.on("error",d),()=>{m.off("friend-added",e),m.off("friend-removed",t),m.off("friend-request-received",a),m.off("friend-request-sent",r),m.off("friend-request-accepted",n),m.off("friend-request-declined",c),m.off("friend-status-changed",o),m.off("error",d)}},[m]);let u=(0,r.useCallback)(()=>{s(m.getFriends()),i(m.getIncomingRequests()),l(m.getOutgoingRequests())},[m]),x=(0,r.useCallback)(async(e,t,s)=>{try{o(!0),await m.sendFriendRequest(e,t,s)}finally{o(!1)}},[m]),p=(0,r.useCallback)(async e=>{try{o(!0),await m.acceptFriendRequest(e)}finally{o(!1)}},[m]),g=(0,r.useCallback)(async e=>{try{o(!0),await m.declineFriendRequest(e)}finally{o(!1)}},[m]),f=(0,r.useCallback)(async e=>{try{o(!0),await m.removeFriend(e)}finally{o(!1)}},[m]),b=(0,r.useCallback)(async e=>{try{return h(!0),await m.searchUsers(e)}finally{h(!1)}},[m]),v=(0,r.useCallback)(e=>m.isFriend(e),[m]),y=(0,r.useCallback)(e=>m.hasPendingRequest(e),[m]),j=(0,r.useCallback)(e=>m.getFriend(e),[m]),w=(0,r.useCallback)((e,t,s)=>{m.simulateIncomingRequest(e,t,s)},[m]);return{friends:t,incomingRequests:a,outgoingRequests:n,isLoading:c,isSearching:d,sendFriendRequest:x,acceptFriendRequest:p,declineFriendRequest:g,removeFriend:f,searchUsers:b,isFriend:v,hasPendingRequest:y,getFriend:j,friendCount:t.length,pendingRequestCount:a.length,addMockFriendRequest:w}}();Array.from(S.values());let P="connected"===k,q=(0,r.useCallback)(e=>{console.log("Joining voice channel:",e),n(!0)},[]),D=(0,r.useCallback)(()=>{console.log("Opening voice settings")},[]),R=(0,r.useCallback)(()=>{let e=[{id:"@alice:matrix.org",name:"Alice Johnson"},{id:"@bob:matrix.org",name:"Bob Smith"},{id:"@charlie:matrix.org",name:"Charlie Brown"},{id:"@diana:matrix.org",name:"Diana Prince"}],t=e[Math.floor(Math.random()*e.length)];t&&U(t.id,t.name)},[U]);return(0,a.jsxs)("div",{className:"min-h-screen bg-discord-dark flex",children:[(0,a.jsxs)("nav",{className:"w-[72px] bg-discord-darker flex flex-col items-center py-3 gap-2 flex-shrink-0","aria-label":"Servers",children:[(0,a.jsx)("button",{className:"w-12 h-12 rounded-2xl bg-discord-accent hover:bg-[#5865f2]/90 transition-all hover:rounded-xl flex items-center justify-center text-white","aria-label":"Home",children:(0,a.jsx)("svg",{className:"w-7 h-7",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"})})}),(0,a.jsx)("div",{className:"w-8 h-0.5 bg-discord-light rounded-full my-1","aria-hidden":"true"}),(0,a.jsx)("button",{className:"w-12 h-12 rounded-2xl bg-discord-light hover:bg-discord-accent transition-all hover:rounded-xl flex items-center justify-center text-white font-semibold","aria-label":"HAOS Server",children:"H"}),(0,a.jsx)("button",{onClick:()=>s(!0),className:"w-12 h-12 rounded-2xl bg-discord-light hover:bg-green-600 transition-all hover:rounded-xl flex items-center justify-center text-green-500 hover:text-white","aria-label":"Add a Server",children:(0,a.jsx)(p.A,{className:"w-6 h-6"})}),(0,a.jsx)("button",{onClick:()=>s(!0),className:"w-12 h-12 rounded-2xl bg-discord-light hover:bg-green-600 transition-all hover:rounded-xl flex items-center justify-center text-green-500 hover:text-white","aria-label":"Explore Servers",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 1a11 11 0 1 0 11 11A11.013 11.013 0 0 0 12 1zm0 20a9 9 0 1 1 9-9 9.01 9.01 0 0 1-9 9zm-.5-14.5v5l4.28 2.54.72-1.21-3.5-2.08V6.5z"})})})]}),(0,a.jsxs)("aside",{className:"w-60 bg-[#2b2d31] flex flex-col flex-shrink-0","aria-label":"Channel list",children:[(0,a.jsxs)("div",{className:"h-12 px-4 flex items-center justify-between border-b border-black/20 shadow-sm",children:[(0,a.jsx)("h2",{className:"font-semibold text-white truncate",children:"HAOS Development"}),(0,a.jsx)("button",{className:"text-gray-400 hover:text-white p-1 rounded hover:bg-white/10","aria-label":"Server settings",children:(0,a.jsx)(g.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:()=>w(!j),className:"flex items-center w-full px-1 py-1 text-xs font-semibold text-gray-400 hover:text-gray-200 uppercase tracking-wide","aria-expanded":j,children:[j?(0,a.jsx)(g.A,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(f.A,{className:"w-3 h-3 mr-1"}),"Text Channels"]}),j&&(0,a.jsx)("div",{className:"mt-1 space-y-0.5",children:eL.map(e=>(0,a.jsxs)("button",{className:"w-full flex items-center gap-2 px-2 py-1.5 rounded text-gray-400 hover:text-gray-200 hover:bg-[#36393f] transition-colors",children:[(0,a.jsx)(l.A,{className:"w-5 h-5 flex-shrink-0 text-gray-400","aria-hidden":"true"}),(0,a.jsx)("span",{className:"flex-1 truncate text-sm text-left",children:e.name}),e.unread>0&&(0,a.jsx)("span",{className:"bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full min-w-[20px] text-center","aria-label":"".concat(e.unread," unread messages"),children:e.unread})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:()=>u(!m),className:"flex items-center w-full px-1 py-1 text-xs font-semibold text-gray-400 hover:text-gray-200 uppercase tracking-wide","aria-expanded":m,children:[m?(0,a.jsx)(g.A,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(f.A,{className:"w-3 h-3 mr-1"}),"Voice Channels"]}),m&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(O,{channels:eR,currentUserId:"user-current",onJoinChannel:q})})]}),(0,a.jsx)("div",{children:(0,a.jsx)(eP,{friends:F,incomingRequests:M,onOpenUserProfile:()=>h(!0),compact:!0})})]}),P&&N&&(0,a.jsx)("div",{className:"p-2 bg-[#232428] border-t border-black/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(b.A,{className:"w-4 h-4 text-green-400 flex-shrink-0","aria-hidden":"true"}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-green-400 truncate",children:"Voice Connected"}),(0,a.jsx)("div",{className:"text-xs text-gray-400 truncate",children:N.name})]})]}),(0,a.jsx)("button",{onClick:()=>n(!0),className:"p-1.5 rounded hover:bg-white/10 text-gray-400 hover:text-white","aria-label":"Open voice channel panel",children:(0,a.jsx)(c.A,{className:"w-4 h-4"})})]})}),(0,a.jsx)("div",{className:"p-2 border-t border-gray-600",children:(0,a.jsx)(eD,{})}),(0,a.jsxs)("div",{className:"p-2 bg-[#232428] flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>h(!0),className:"flex items-center gap-2 flex-1 min-w-0 hover:bg-white/10 rounded p-1 transition-colors","aria-label":"Open user profile",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#5865f2] flex items-center justify-center text-white text-sm font-semibold",children:T?(0,a.jsx)("img",{src:T,alt:E||"User",className:"w-full h-full rounded-full object-cover"}):E?E.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"U"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-white truncate",children:E||"Username"}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 truncate",children:["Online",M.length>0&&(0,a.jsxs)("span",{className:"ml-2 bg-red-500 text-white px-1.5 py-0.5 rounded-full text-xs",children:[M.length," friend request",1!==M.length?"s":""]})]})]})]}),(0,a.jsx)("button",{onClick:D,className:"p-1.5 rounded hover:bg-white/10 text-gray-400 hover:text-white","aria-label":"User settings",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})})]})]}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col bg-discord-light min-w-0",children:[(0,a.jsx)("header",{className:"h-12 px-4 flex items-center justify-between border-b border-black/20 shadow-sm bg-[#313338]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.A,{className:"w-6 h-6 text-gray-400","aria-hidden":"true"}),(0,a.jsx)("h1",{className:"font-semibold text-white",children:"general"})]})}),(0,a.jsxs)("div",{className:"flex-1 flex",children:[(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto px-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Welcome to HAOS v2"}),(0,a.jsx)("p",{className:"text-gray-400 mb-6",children:"A Discord-style Matrix client with voice chat powered by LiveKit"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/servers/discover"),className:"discord-button px-6 py-2.5 bg-discord-accent hover:bg-[#4752c4] text-white font-medium rounded transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"Discover Servers"]}),(0,a.jsx)("button",{onClick:()=>s(!0),className:"discord-button px-4 py-2.5 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded transition-colors text-sm",children:"Quick Browse"}),(0,a.jsxs)("button",{onClick:()=>q("vc-2"),className:"px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white font-medium rounded transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(b.A,{className:"w-4 h-4"}),"Join Voice"]}),(0,a.jsxs)("button",{onClick:()=>h(!0),className:"px-6 py-2.5 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(y.A,{className:"w-4 h-4"}),"Manage Friends"]}),(0,a.jsx)("button",{onClick:R,className:"px-6 py-2.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded transition-colors text-sm",children:"+ Mock Friend Request"})]})]})}),i&&(0,a.jsx)("aside",{className:"w-80 border-l border-black/20 overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:"Voice Channel"}),(0,a.jsx)("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-white p-1 rounded hover:bg-white/10","aria-label":"Close voice panel",children:"\xd7"})]}),(0,a.jsx)(es,{showVideoGrid:!1})]})})]})]}),P&&(0,a.jsx)(ey,{roomName:null==N?void 0:N.id,userId:"current-user",onSettingsClick:D}),(0,a.jsx)(A,{open:t,onOpenChange:s}),(0,a.jsx)(eM,{open:o,onOpenChange:h})]})}function eV(){let{setUser:e,isAuthenticated:t}=eC();return((0,r.useEffect)(()=>{let t=localStorage.getItem("haos-matrix-session");if(localStorage.getItem("haos-first-run-completed"),t)try{let s=JSON.parse(t);e({userId:s.userId,displayName:s.displayName,avatarUrl:s.avatarUrl})}catch(e){console.error("Failed to parse Matrix session:",e)}},[e]),t)?(0,a.jsx)(eI,{}):(0,a.jsx)(u,{onComplete:()=>{localStorage.setItem("haos-first-run-completed","true")}})}},42464:(e,t,s)=>{Promise.resolve().then(s.bind(s,13462))}},e=>{e.O(0,[796,731,475,357,341,812,572,42,292,760,358],()=>e(e.s=42464)),_N_E=e.O()}]);