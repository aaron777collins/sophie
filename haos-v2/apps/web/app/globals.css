@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== MOBILE-FIRST BASE STYLES ===== */
@layer base {
  * {
    @apply border-gray-200 dark:border-gray-700;
    /* Ensure all elements are touch-friendly by default */
    touch-action: manipulation;
  }
  
  html {
    /* Prevent horizontal scrolling on mobile */
    overflow-x: hidden;
    /* Smooth scrolling */
    scroll-behavior: smooth;
    /* Prevent zoom on input focus (iOS Safari) */
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
  }
  
  body {
    @apply bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans;
    /* Prevent horizontal scrolling */
    overflow-x: hidden;
    /* Better font rendering on mobile */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* Prevent pull-to-refresh on iOS */
    overscroll-behavior-y: none;
  }

  /* ===== SAFE AREA SUPPORT FOR NOTCHED DEVICES ===== */
  :root {
    /* CSS custom properties for safe areas */
    --safe-area-inset-top: env(safe-area-inset-top, 0px);
    --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-inset-left: env(safe-area-inset-left, 0px);
    --safe-area-inset-right: env(safe-area-inset-right, 0px);
    
    /* Mobile-specific heights */
    --mobile-header-height: 56px;
    --mobile-nav-height: 64px;
    --mobile-input-height: 44px;
    
    /* Touch target minimum size (WCAG AA) */
    --touch-target-min: 44px;
  }

  /* ===== CUSTOM SCROLLBARS ===== */
  /* Webkit browsers (Chrome, Safari, Edge) */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800;
  }
  
  ::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-600 rounded-full;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-500;
  }

  /* Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: rgb(156 163 175) rgb(243 244 246);
  }

  @media (prefers-color-scheme: dark) {
    * {
      scrollbar-color: rgb(75 85 99) rgb(31 41 55);
    }
  }
}

/* ===== MOBILE-OPTIMIZED COMPONENTS ===== */
@layer components {
  /* ===== TOUCH-FRIENDLY BUTTONS ===== */
  .btn-mobile {
    @apply px-6 py-3 rounded-xl font-medium text-base;
    @apply transition-all duration-200 touch-manipulation;
    @apply active:scale-95;
    min-height: var(--touch-target-min);
    min-width: var(--touch-target-min);
  }

  .btn-primary {
    @apply btn-mobile bg-blue-600 hover:bg-blue-700 active:bg-blue-800;
    @apply text-white shadow-lg hover:shadow-xl;
  }

  .btn-secondary {
    @apply btn-mobile bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600;
    @apply text-gray-900 dark:text-gray-100;
  }

  .btn-danger {
    @apply btn-mobile bg-red-600 hover:bg-red-700 active:bg-red-800;
    @apply text-white shadow-lg hover:shadow-xl;
  }

  /* ===== MOBILE-OPTIMIZED INPUTS ===== */
  .input-mobile {
    @apply w-full px-4 py-3 rounded-xl border-2;
    @apply bg-white dark:bg-gray-800;
    @apply border-gray-200 dark:border-gray-600;
    @apply text-gray-900 dark:text-gray-100;
    @apply placeholder-gray-500 dark:placeholder-gray-400;
    @apply focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20;
    @apply transition-all duration-200;
    /* Prevent zoom on iOS */
    font-size: 16px;
    min-height: var(--touch-target-min);
  }

  .textarea-mobile {
    @apply input-mobile resize-none;
    /* Touch-friendly scrolling */
    -webkit-overflow-scrolling: touch;
    /* Prevent horizontal scrolling */
    overflow-x: hidden;
  }

  /* ===== MOBILE LAYOUT UTILITIES ===== */
  .safe-area-top {
    padding-top: var(--safe-area-inset-top);
  }

  .safe-area-bottom {
    padding-bottom: var(--safe-area-inset-bottom);
  }

  .safe-area-left {
    padding-left: var(--safe-area-inset-left);
  }

  .safe-area-right {
    padding-right: var(--safe-area-inset-right);
  }

  .safe-area-x {
    padding-left: var(--safe-area-inset-left);
    padding-right: var(--safe-area-inset-right);
  }

  .safe-area-y {
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
  }

  .safe-area {
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
    padding-left: var(--safe-area-inset-left);
    padding-right: var(--safe-area-inset-right);
  }

  /* Mobile-specific spacing shortcuts */
  .pb-safe {
    padding-bottom: calc(1rem + var(--safe-area-inset-bottom));
  }

  .pt-safe {
    padding-top: calc(1rem + var(--safe-area-inset-top));
  }

  .pb-safe-bottom {
    padding-bottom: var(--safe-area-inset-bottom);
  }

  .pt-safe-top {
    padding-top: var(--safe-area-inset-top);
  }

  /* ===== CHAT-SPECIFIC MOBILE STYLES ===== */
  .chat-container {
    /* Full height minus header and input area */
    height: calc(100vh - var(--mobile-header-height) - var(--mobile-nav-height) - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
    /* Touch-friendly scrolling */
    -webkit-overflow-scrolling: touch;
    /* Prevent overscroll bounce */
    overscroll-behavior: none;
  }

  .chat-message {
    @apply px-4 py-2 max-w-[85%];
    /* Ensure readable text size on mobile */
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .chat-message-bubble {
    @apply px-4 py-3 rounded-2xl;
    min-height: var(--touch-target-min);
    /* Smooth animations */
    transition: transform 0.1s ease-out;
  }

  .chat-message-bubble:active {
    transform: scale(0.98);
  }

  .chat-avatar {
    @apply w-10 h-10 rounded-full flex-shrink-0;
    /* Ensure avatars are touch-friendly */
    min-width: 40px;
    min-height: 40px;
  }

  /* ===== MODAL STYLES FOR MOBILE ===== */
  .modal-mobile {
    /* Full-screen modals on small screens */
    @apply fixed inset-0 z-50;
  }

  .modal-content {
    @apply bg-white dark:bg-gray-800 rounded-t-2xl;
    @apply max-h-[90vh] overflow-y-auto;
    /* Touch-friendly scrolling */
    -webkit-overflow-scrolling: touch;
  }

  .modal-backdrop {
    @apply fixed inset-0 bg-black/50 z-40;
    /* Prevent scroll behind modal */
    touch-action: none;
  }

  /* ===== ANIMATION UTILITIES ===== */
  .fade-in {
    animation: fadeIn 0.2s ease-out;
  }

  .slide-up {
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scale-in {
    animation: scaleIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from { 
      opacity: 0;
      transform: translateY(100%); 
    }
    to { 
      opacity: 1;
      transform: translateY(0); 
    }
  }

  @keyframes scaleIn {
    from { 
      opacity: 0;
      transform: scale(0.9); 
    }
    to { 
      opacity: 1;
      transform: scale(1); 
    }
  }

  /* ===== ACCESSIBILITY IMPROVEMENTS ===== */
  .focus-visible {
    @apply outline-none ring-2 ring-blue-500 ring-offset-2 ring-offset-white dark:ring-offset-gray-900;
  }

  /* Skip link for screen readers */
  .skip-link {
    @apply sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4;
    @apply bg-blue-600 text-white px-4 py-2 rounded-lg z-50;
  }

  /* ===== TEXT UTILITIES ===== */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ===== LOADING STATES ===== */
  .skeleton {
    @apply bg-gray-200 dark:bg-gray-700 animate-pulse rounded;
  }

  .spinner {
    @apply w-6 h-6 border-2 border-gray-200 border-t-blue-600 rounded-full animate-spin;
  }
}

/* ===== RESPONSIVE BREAKPOINTS ===== */
/* Mobile-first approach with progressive enhancement */

/* Small mobile devices (< 375px) */
@media (max-width: 374px) {
  .chat-message {
    @apply max-w-[90%];
  }
  
  .modal-content {
    @apply mx-2 rounded-xl;
    max-height: calc(100vh - 2rem);
  }
  
  .btn-mobile {
    @apply text-sm px-4 py-2;
  }
}

/* Standard mobile devices (375px - 767px) */
@media (max-width: 767px) {
  /* Hide desktop-only elements */
  .desktop-only {
    @apply hidden;
  }

  /* Show mobile-only elements */
  .mobile-only {
    @apply block;
  }

  /* Full-width modals on mobile */
  .modal-mobile {
    @apply p-0;
  }

  .modal-content {
    @apply rounded-t-2xl rounded-b-none;
    min-height: 50vh;
  }

  /* Larger touch targets on mobile */
  .chat-avatar {
    @apply w-8 h-8;
  }

  /* Optimized spacing for mobile */
  .chat-container {
    @apply px-2;
  }

  .chat-message {
    @apply px-3 py-2;
  }
}

/* Tablet devices (768px - 1023px) */
@media (min-width: 768px) and (max-width: 1023px) {
  .tablet-layout {
    @apply block;
  }

  /* Larger modals on tablet */
  .modal-content {
    @apply mx-4 rounded-2xl max-w-md;
    max-height: 80vh;
  }

  /* Two-column chat layout option */
  .chat-container-tablet {
    @apply grid grid-cols-5 gap-4;
  }

  .chat-messages-tablet {
    @apply col-span-3;
  }

  .chat-sidebar-tablet {
    @apply col-span-2;
  }
}

/* Desktop devices (1024px+) */
@media (min-width: 1024px) {
  /* Hide mobile-only elements */
  .mobile-only {
    @apply hidden;
  }

  /* Show desktop-only elements */
  .desktop-only {
    @apply block;
  }

  /* Desktop modal sizing */
  .modal-content {
    @apply mx-auto max-w-lg rounded-2xl;
    max-height: 85vh;
  }

  /* Hover effects only on desktop */
  .btn-mobile:hover {
    @apply shadow-lg transform-gpu;
  }

  .chat-message-bubble:hover {
    @apply shadow-sm;
  }
}

/* ===== LANDSCAPE ORIENTATION ===== */
@media (orientation: landscape) and (max-height: 500px) {
  /* Adjust for landscape phones */
  .modal-content {
    max-height: 90vh;
  }

  .chat-container {
    /* Reduce header height in landscape */
    height: calc(100vh - 48px - 56px - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  }

  /* Smaller avatars and spacing in landscape */
  .chat-avatar {
    @apply w-8 h-8;
  }

  .chat-message {
    @apply py-1;
  }
}

/* ===== HIGH DPI / RETINA DISPLAYS ===== */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  /* Crisp borders on high DPI displays */
  .chat-message-bubble {
    border: 0.5px solid rgba(0, 0, 0, 0.1);
  }

  /* Better icon rendering */
  .icon {
    image-rendering: -webkit-optimize-contrast;
  }
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce) {
  /* Disable animations for users who prefer reduced motion */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .fade-in,
  .slide-up,
  .scale-in {
    animation: none;
  }
}

/* ===== DARK MODE IMPROVEMENTS ===== */
@media (prefers-color-scheme: dark) {
  /* Ensure good contrast in dark mode */
  .chat-message-bubble {
    border-color: rgba(255, 255, 255, 0.1);
  }

  /* Adjust shadows for dark mode */
  .btn-primary {
    box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39);
  }

  .modal-content {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }
}

/* ===== PRINT STYLES ===== */
@media print {
  /* Hide interactive elements when printing */
  .btn-mobile,
  .modal-mobile,
  .mobile-nav {
    @apply hidden;
  }

  /* Optimize text for printing */
  .chat-message {
    @apply text-black bg-white border border-gray-300 rounded-none;
    font-size: 12pt;
    line-height: 1.4;
  }
}

/* ===== UTILITY CLASSES ===== */
@layer utilities {
  /* Touch-friendly sizing */
  .touch-target {
    min-width: var(--touch-target-min);
    min-height: var(--touch-target-min);
  }

  /* Prevent text selection for UI elements */
  .no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  /* Hardware acceleration for smooth animations */
  .gpu-accelerated {
    transform: translateZ(0);
    will-change: transform;
  }

  /* Truncate text with ellipsis */
  .truncate-multiline {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
  }

  /* Hide scrollbar but keep functionality */
  .scrollbar-hidden {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hidden::-webkit-scrollbar {
    display: none;
  }

  /* Full-height with safe area consideration */
  .full-height-safe {
    height: calc(100vh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  }

  /* Interactive states */
  .interactive {
    @apply transition-all duration-200 ease-out cursor-pointer;
    @apply hover:scale-105 active:scale-95;
    @apply focus-visible:ring-2 focus-visible:ring-blue-500;
  }
}